import numpy as np, matplotlib.pyplot as plt, detect_peaks
from scipy.signal import medfilt as mf

x_pix = range(1024)
ar_i = [-123.18181818181817, -113.09090909090907, -488.45454545454544, -327.36363636363632, -69.727272727272734, -15.545454545454545, -13.0, -7.8181818181818175, 22.0, 93.909090909090921, 1757.272727272727, 3597.454545454545, 2447.1818181818185, 848.09090909090924, 147.36363636363637, -3.2727272727272725, -23.636363636363637, -8.0, -22.636363636363637, -30.90909090909091, -14.454545454545455, -20.272727272727273, -36.545454545454547, -33.636363636363633, -29.545454545454547, -23.636363636363637, -22.727272727272727, 261.27272727272731, 463.90909090909093, 399.0, 176.72727272727275, 29.545454545454547, -25.545454545454547, -26.909090909090907, -31.18181818181818, -35.63636363636364, -36.727272727272727, -31.90909090909091, -38.18181818181818, -33.0, -29.18181818181818, -34.090909090909093, -31.81818181818182, -34.272727272727266, -34.81818181818182, -31.18181818181818, -28.818181818181817, -25.363636363636363, -25.0, -27.18181818181818, -21.272727272727273, -15.636363636363637, -20.636363636363637, -12.636363636363637, -13.454545454545455, -15.90909090909091, -18.90909090909091, -17.636363636363633, -7.0000000000000009, -12.09090909090909, -12.727272727272727, -16.272727272727273, -7.0000000000000009, 14.545454545454547, 41.272727272727273, 235.5454545454545, 227.27272727272725, 105.27272727272727, 66.181818181818173, 362.81818181818176, 517.45454545454538, 712.54545454545462, 487.27272727272731, 201.27272727272728, 46.727272727272734, 73.545454545454547, 118.00000000000001, 57.36363636363636, 16.636363636363637, 16.727272727272727, 151.27272727272728, 223.54545454545456, 141.81818181818184, 38.545454545454547, -0.99999999999999989, 7.6363636363636367, 31.363636363636363, 24.63636363636364, 4.2727272727272734, -3.9090909090909092, -6.7272727272727266, -5.1818181818181817, -4.0909090909090908, -0.18181818181818232, -2.8181818181818175, -0.63636363636363624, -2.3636363636363642, 5.7272727272727266, 0.81818181818181801, -3.8181818181818179, 6.6363636363636349, 2.9090909090909087, -11.818181818181818, -5.2727272727272725, 9.0, 3.7272727272727275, 12.90909090909091, 1.3636363636363638, 8.4545454545454533, 5.9090909090909074, 20.818181818181817, 75.63636363636364, 286.09090909090907, 2352.8181818181815, 3304.545454545455, 2030.5454545454545, 609.45454545454538, 119.63636363636365, 42.272727272727273, 21.545454545454547, 22.272727272727273, 5.1818181818181817, 14.090909090909092, 9.454545454545455, 7.5454545454545459, 20.272727272727273, 239.45454545454544, 847.90909090909088, 672.45454545454538, 292.27272727272725, 66.545454545454547, 6.6363636363636349, 6.8181818181818175, 14.545454545454545, 7.9090909090909074, 0.81818181818181746, 1.1818181818181821, 1.6363636363636362, 15.272727272727273, 42.27272727272728, 479.18181818181819, 1035.3636363636363, 728.81818181818176, 573.45454545454538, 655.4545454545455, 508.63636363636363, 456.63636363636368, 294.54545454545456, 109.90909090909091, 43.272727272727273, 25.181818181818183, 158.27272727272731, 190.72727272727272, 123.81818181818181, 62.18181818181818, 3.7272727272727266, 17.18181818181818, 11.18181818181818, 6.1818181818181817, 2.8181818181818183, -8.7272727272727284, -7.3636363636363624, -2.0000000000000004, -12.181818181818182, -6.5454545454545459, 2.0, -4.545454545454545, 13.727272727272727, 23.727272727272727, 10.09090909090909, 5.7272727272727275, 3.7272727272727275, 1.8181818181818179, -11.727272727272728, 0.36363636363636376, -1.8181818181818183, 7.6363636363636367, -2.7272727272727271, 1.0909090909090906, -4.7272727272727275, -2.272727272727272, 0.18181818181818188, -2.5454545454545454, -0.45454545454545431, 1.0000000000000007, -13.90909090909091, 8.2727272727272734, 29.36363636363636, 8.454545454545455, 3.1818181818181817, 10.0, 4.7272727272727275, 2.4545454545454541, 9.0, 7.2727272727272734, 26.636363636363633, 32.909090909090914, 19.545454545454543, 38.18181818181818, 7.6363636363636358, 2.1818181818181817, 11.090909090909088, 72.818181818181813, 146.90909090909091, 302.54545454545456, 226.0, 92.63636363636364, 17.90909090909091, 11.09090909090909, 5.7272727272727275, 4.3636363636363633, 16.454545454545453, 90.818181818181813, 882.27272727272725, 1065.4545454545455, 586.81818181818176, 137.90909090909091, 25.18181818181818, 2.0000000000000004, -7.2727272727272725, -5.3636363636363633, 0.90909090909090928, 2.9090909090909096, -12.0, -14.636363636363637, -9.3636363636363633, -4.0000000000000009, 110.09090909090908, 141.00000000000003, 67.63636363636364, 3.9090909090909083, -10.363636363636362, -1.5454545454545459, 143.81818181818184, 167.81818181818181, 74.454545454545453, -9.545454545454545, -25.727272727272727, -27.727272727272727, -30.272727272727277, -36.18181818181818, -29.909090909090907, -15.727272727272727, -13.181818181818178, -32.272727272727273, -36.727272727272727, -44.272727272727266, -51.81818181818182, -50.818181818181813, -59.63636363636364, -56.45454545454546, -58.45454545454546, -60.000000000000014, -55.636363636363647, -58.81818181818182, -55.181818181818187, -59.36363636363636, -59.818181818181813, -62.818181818181827, -19.181818181818183, 281.18181818181819, 267.36363636363637, 83.000000000000014, -38.818181818181813, -59.36363636363636, -69.909090909090921, -63.636363636363633, -45.545454545454547, 396.90909090909082, 1246.6363636363637, 903.81818181818176, 325.81818181818181, 193.09090909090909, 83.72727272727272, -30.0, -78.090909090909093, -86.909090909090921, -98.181818181818187, -99.090909090909093, -105.54545454545453, -110.00000000000001, -105.81818181818181, -98.181818181818187, -100.81818181818181, -102.36363636363637, -105.63636363636364, -104.90909090909091, -105.63636363636363, -104.90909090909091, -105.45454545454547, -94.909090909090921, 57.36363636363636, 313.90909090909088, 193.54545454545456, -10.363636363636363, -92.27272727272728, -98.36363636363636, -107.81818181818183, -104.63636363636364, -108.72727272727273, -109.27272727272725, -115.90909090909092, -107.36363636363639, -100.36363636363636, -91.0, -85.090909090909093, -89.454545454545453, -85.090909090909093, -74.909090909090907, -61.090909090909093, -14.272727272727275, 338.63636363636363, 6291.0, 10296.81818181818, 6253.454545454545, 1564.9090909090908, 194.0, -27.36363636363636, -65.999999999999986, -84.27272727272728, -94.27272727272728, -104.45454545454545, -109.45454545454545, -111.99999999999999, -120.81818181818184, -118.18181818181819, -117.36363636363637, -124.72727272727272, -122.54545454545453, -127.72727272727273, -125.27272727272728, -122.63636363636365, -117.99999999999999, -119.90909090909091, -126.81818181818181, -121.63636363636363, -117.45454545454547, -129.90909090909091, -135.18181818181819, -127.36363636363636, -129.27272727272728, -126.63636363636363, -127.00000000000003, -129.54545454545453, -128.81818181818181, -129.45454545454547, -126.90909090909089, -135.72727272727272, -127.99999999999999, -124.54545454545456, -131.00000000000003, -132.0, -130.18181818181819, -132.63636363636363, -117.81818181818181, -129.36363636363635, -130.54545454545453, -128.09090909090907, -129.90909090909091, -125.63636363636365, -109.45454545454544, -109.81818181818183, -118.63636363636363, -112.72727272727272, 184.45454545454547, 492.36363636363632, 282.81818181818181, -17.727272727272727, -105.36363636363637, -127.36363636363635, -120.63636363636365, -127.81818181818181, -132.63636363636365, -126.72727272727275, -131.90909090909093, -132.54545454545456, -129.45454545454547, -136.27272727272728, -129.54545454545453, -130.54545454545453, -135.90909090909093, -136.36363636363637, -135.27272727272728, -136.54545454545456, -129.45454545454544, -134.18181818181816, -132.36363636363635, -128.72727272727272, -127.90909090909091, -134.36363636363637, -133.0, -129.0, -128.54545454545453, -125.36363636363636, -122.90909090909091, -134.0, -128.72727272727275, -129.0, -133.09090909090909, -126.18181818181817, -124.0, -122.45454545454545, -115.09090909090908, -70.36363636363636, 3.8181818181818188, -42.090909090909086, -102.36363636363637, -113.90909090909091, -112.72727272727275, -104.27272727272727, -73.818181818181813, -29.63636363636363, 805.4545454545455, 3171.1818181818176, 2648.181818181818, 776.0, 33.818181818181813, -88.181818181818187, -102.72727272727273, -115.36363636363637, -125.09090909090909, -119.36363636363637, -124.54545454545455, -119.90909090909092, -114.27272727272728, -120.0, -127.18181818181819, -128.72727272727272, -127.18181818181819, -126.81818181818181, -132.27272727272728, -130.0, -128.18181818181819, -129.18181818181819, -127.81818181818181, -129.09090909090909, -125.72727272727272, -126.00000000000003, -128.27272727272725, -124.90909090909089, -115.90909090909091, -117.63636363636364, -119.36363636363637, -133.18181818181819, -128.45454545454547, -118.90909090909092, -115.54545454545455, -114.09090909090909, -121.45454545454544, -130.27272727272728, -119.81818181818183, -125.45454545454545, -123.27272727272727, -128.18181818181816, -127.72727272727272, -127.09090909090908, -121.72727272727272, -116.90909090909091, -119.36363636363636, -127.54545454545453, -119.36363636363636, -124.45454545454547, -123.54545454545453, -120.09090909090908, -42.090909090909093, 345.09090909090907, 466.81818181818181, 182.36363636363632, -64.727272727272734, -111.00000000000001, -115.63636363636364, -111.27272727272729, -105.18181818181817, -115.18181818181819, -116.54545454545453, -123.36363636363637, -126.72727272727272, -129.63636363636365, -114.63636363636363, -98.545454545454547, -63.090909090909086, -83.545454545454547, -113.0, -121.81818181818181, -126.90909090909092, -118.00000000000001, -91.818181818181827, -88.36363636363636, -107.27272727272728, -118.45454545454545, -121.81818181818183, -123.09090909090911, -121.72727272727272, -126.45454545454544, -121.72727272727273, -119.90909090909093, -128.81818181818184, -114.45454545454545, -104.99999999999997, -105.00000000000001, -111.63636363636363, -116.0, -116.63636363636363, -114.18181818181817, -121.72727272727272, -125.18181818181817, -127.90909090909091, -120.72727272727273, -119.90909090909091, -118.0, -121.45454545454547, -125.63636363636363, 1107.3636363636365, -397.36363636363632, -335.81818181818181, -169.45454545454544, -139.99999999999997, -141.63636363636363, -136.72727272727272, -133.18181818181822, -132.0, -140.18181818181816, -137.81818181818181, -138.72727272727269, -137.54545454545453, -132.36363636363637, -137.63636363636365, -133.09090909090909, -139.36363636363637, -142.0, -133.18181818181819, -136.81818181818181, -136.90909090909093, -135.09090909090909, -131.27272727272728, -135.45454545454544, -139.18181818181819, -138.63636363636363, -135.90909090909091, -134.27272727272728, -141.18181818181819, -130.81818181818181, -129.72727272727272, -133.72727272727275, -140.90909090909091, -133.36363636363637, -131.45454545454547, -137.54545454545456, -137.0, -136.27272727272728, -130.0, -129.36363636363637, -129.27272727272728, -133.72727272727272, -129.45454545454547, -135.54545454545456, -138.0, -130.90909090909091, -133.18181818181816, -135.36363636363635, -131.09090909090909, -119.72727272727272, -123.27272727272727, -127.18181818181817, -131.18181818181819, -128.72727272727275, -123.90909090909091, -122.18181818181817, -125.00000000000001, -124.90909090909091, -130.27272727272728, -120.54545454545456, -123.18181818181822, -122.18181818181817, -127.36363636363636, -126.09090909090909, -124.00000000000003, -123.27272727272728, -122.00000000000001, -125.0, -121.09090909090909, -121.27272727272728, -123.90909090909089, -124.09090909090909, -120.81818181818183, -119.72727272727272, -121.09090909090909, -112.90909090909091, -123.81818181818183, -117.45454545454547, -122.72727272727272, -110.45454545454547, -115.63636363636364, -119.90909090909091, -115.72727272727272, -119.18181818181819, -115.90909090909093, -111.90909090909091, -117.63636363636365, -112.81818181818181, -108.81818181818183, -115.63636363636364, -108.72727272727272, -115.63636363636364, -102.63636363636363, -35.272727272727273, 42.909090909090914, -54.272727272727266, -96.909090909090907, -111.81818181818183, -109.09090909090909, -111.99999999999999, -116.36363636363636, -109.00000000000001, -102.27272727272728, -102.72727272727272, -108.09090909090908, -109.45454545454545, -91.999999999999986, -90.0, -3.9090909090909087, 88.000000000000014, -29.454545454545453, -92.454545454545453, -104.09090909090909, -101.54545454545456, -87.72727272727272, -70.090909090909093, -85.0, -97.72727272727272, -102.18181818181817, -91.909090909090907, -90.636363636363654, -88.909090909090907, -97.545454545454547, -103.18181818181819, -97.36363636363636, -96.818181818181827, -98.272727272727266, -95.545454545454533, -93.636363636363626, -90.090909090909079, -88.909090909090907, -91.363636363636374, -91.63636363636364, -85.272727272727266, -95.72727272727272, -94.72727272727272, -86.818181818181827, -85.36363636363636, -73.090909090909093, -89.545454545454547, -91.454545454545453, -80.181818181818187, -88.181818181818187, -62.63636363636364, -19.454545454545453, -25.636363636363637, -35.999999999999993, -88.727272727272734, -79.090909090909093, -74.909090909090921, -75.0, -80.454545454545453, -71.909090909090907, -76.72727272727272, -74.454545454545453, -77.454545454545467, -77.727272727272748, -71.454545454545453, -68.0, -71.0, -64.36363636363636, -65.181818181818173, -67.818181818181813, -66.72727272727272, -69.545454545454533, -61.363636363636367, -50.090909090909086, -56.181818181818187, -57.18181818181818, -45.636363636363633, -49.54545454545454, -59.0, -49.818181818181813, 57.545454545454554, 1012.9090909090909, 968.18181818181824, 190.27272727272728, 13.181818181818183, -2.3636363636363629, -45.18181818181818, -50.090909090909086, -37.909090909090921, -45.727272727272727, -46.727272727272727, -39.818181818181813, -35.454545454545453, -5.7272727272727266, -20.272727272727273, -32.454545454545453, -43.272727272727273, -44.090909090909093, -40.18181818181818, -38.363636363636367, -31.363636363636367, -14.818181818181818, -25.18181818181818, -31.36363636363636, -36.18181818181818, -39.81818181818182, -32.454545454545453, -30.18181818181818, -34.454545454545453, -26.36363636363637, -18.09090909090909, -19.636363636363633, -27.363636363636363, -20.454545454545453, -28.454545454545453, -26.090909090909093, -20.272727272727273, 2.8181818181818175, 412.36363636363632, 721.09090909090912, 210.3636363636364, 14.636363636363637, -14.545454545454543, -3.8181818181818188, -1.4545454545454541, -11.818181818181818, -13.727272727272725, -17.363636363636363, -12.272727272727273, -14.272727272727273, -16.818181818181813, -12.181818181818182, -12.090909090909088, -3.454545454545455, -7.7272727272727275, -5.7272727272727275, 2.454545454545455, 4.0000000000000009, 2.0, 0.54545454545454541, 2.3636363636363633, 2.4545454545454546, 17.27272727272727, 9.9999999999999982, 5.3636363636363624, 4.0909090909090908, 4.7272727272727266, -1.9999999999999996, 9.0, 17.09090909090909, 20.09090909090909, 32.18181818181818, 22.18181818181818, 63.727272727272727, 95.636363636363654, 43.27272727272728, 31.454545454545457, 19.727272727272727, 16.181818181818183, 34.181818181818187, 21.727272727272727, 37.090909090909086, 37.18181818181818, 41.18181818181818, 41.18181818181818, 40.181818181818187, 40.63636363636364, 47.18181818181818, 48.818181818181813, 57.181818181818187, 54.727272727272727, 54.63636363636364, 53.36363636363636, 110.45454545454544, 310.27272727272725, 151.72727272727272, 71.72727272727272, 49.818181818181813, 65.454545454545453, 64.181818181818187, 68.272727272727266, 74.27272727272728, 76.090909090909093, 59.45454545454546, 66.545454545454547, 66.181818181818187, 63.18181818181818, 80.999999999999986, 84.454545454545453, 84.181818181818173, 92.27272727272728, 87.181818181818201, 87.63636363636364, 94.545454545454561, 93.545454545454533, 98.272727272727266, 109.63636363636363, 133.18181818181816, 100.36363636363637, 93.545454545454547, 100.45454545454545, 115.54545454545456, 103.36363636363637, 126.0, 121.18181818181817, 103.18181818181817, 113.0, 123.09090909090909, 122.81818181818184, 115.18181818181817, 120.45454545454547, 133.0, 115.81818181818181, 109.45454545454545, 110.45454545454544, 108.63636363636361, 125.0, 141.00000000000003, 123.36363636363637, 135.0, 125.09090909090909, 128.18181818181819, 140.45454545454547, 133.90909090909091, 151.6363636363636, 174.09090909090909, 155.18181818181816, 150.0, 170.27272727272728, 184.90909090909091, 152.0, 141.45454545454544, 160.54545454545453, 164.54545454545459, 157.63636363636365, 169.09090909090909, 176.36363636363635, 179.90909090909093, 173.63636363636363, 185.54545454545456, 187.00000000000003, 180.18181818181822, 195.54545454545456, 196.27272727272725, 198.54545454545456, 212.81818181818181, 213.0, 197.18181818181819, 211.81818181818187, 236.72727272727272, 212.45454545454547, 207.18181818181819, 188.00000000000003, 231.0, 225.36363636363637, 226.72727272727272, 235.09090909090909, 243.54545454545453, 249.18181818181816, 221.09090909090912, 247.0, 226.27272727272722, 252.09090909090909, 256.18181818181819, 242.99999999999997, 259.45454545454544, 256.18181818181824, 262.72727272727275, 265.0, 281.63636363636363, 305.63636363636363, 284.54545454545456, 292.90909090909088, 260.54545454545456, 269.45454545454544, 278.54545454545456, 265.09090909090907, 289.18181818181819, 305.72727272727269, 340.63636363636363, 303.81818181818181, 268.45454545454544, 288.4545454545455, 327.09090909090907, 323.4545454545455, 310.2727272727272, 299.81818181818181, 326.27272727272725, 325.09090909090912, 347.63636363636368, 352.18181818181819, 351.18181818181807, 361.81818181818181, 361.09090909090907, 364.90909090909093, 372.18181818181813, 356.63636363636368, 384.36363636363637, 388.7272727272728, 366.99999999999994, 387.00000000000006, 406.81818181818187, 421.27272727272725, 395.18181818181819, 392.5454545454545, 412.90909090909088, 424.72727272727275, 395.00000000000006, 422.36363636363632, 394.54545454545456, 443.45454545454544, 422.27272727272731, 439.0, 441.09090909090912, 452.36363636363643, 463.90909090909099, 463.09090909090907, 470.4545454545455, 463.63636363636363, 458.54545454545456, 505.18181818181819, 504.90909090909093, 492.36363636363632, 460.72727272727269, 487.81818181818187, 494.63636363636363, 531.72727272727275, 494.90909090909088, 551.18181818181813, 535.63636363636363, 538.54545454545462, 532.18181818181824, 556.81818181818176, 597.09090909090912, 590.81818181818187, 713.5454545454545, 667.0, 608.81818181818176, 592.4545454545455, 546.09090909090912, 577.90909090909076, 575.72727272727263, 575.36363636363637, 1898.4545454545455, 752.5454545454545, 586.81818181818187, 590.81818181818187, 628.18181818181813, 598.54545454545462, 606.09090909090912, 629.90909090909088, 661.63636363636363, 658.36363636363637, 673.18181818181813, 676.81818181818198, 693.09090909090912, 672.18181818181824, 646.5454545454545, 678.0, 610.4545454545455, 672.36363636363626, 706.72727272727275, 674.36363636363637, 665.72727272727263, 688.72727272727275, 696.09090909090901, 677.72727272727263, 731.45454545454538, 731.90909090909088, 731.63636363636363, 755.72727272727263, 768.18181818181813, 769.09090909090901, 793.18181818181802, 773.72727272727275, 754.0, 724.4545454545455, 740.81818181818176, 755.5454545454545, 751.00000000000011, 780.0, 795.81818181818176, 807.72727272727275, 774.36363636363637, 810.0, 815.63636363636351, 753.63636363636363, 785.36363636363637, 805.90909090909088, 797.90909090909088, 883.45454545454538, 777.72727272727275, 822.27272727272725, 807.90909090909099, 824.63636363636374, 838.72727272727275, 782.27272727272714, 855.27272727272737, 872.09090909090912, 836.63636363636351, 856.36363636363637, 859.09090909090912, 891.36363636363626, 916.27272727272737, 922.18181818181813, 904.27272727272737, 986.4545454545455, 1060.2727272727273, 962.36363636363626, 987.90909090909099, 1019.7272727272729, 1001.181818181818, 979.5454545454545, 1010.1818181818181, 1039.3636363636365, 1054.4545454545455, 1062.7272727272725, 1081.9999999999998, 1081.9999999999998]
xe_i = [-69.818181818181813, -59.909090909090907, -463.18181818181819, -301.54545454545456, -36.18181818181818, 15.000000000000002, 21.81818181818182, 22.454545454545457, 22.36363636363636, 16.454545454545457, 31.27272727272727, 25.545454545454543, 19.454545454545453, 25.181818181818183, 52.454545454545446, 259.90909090909093, 953.18181818181802, 803.90909090909111, 364.5454545454545, 86.818181818181813, 46.818181818181813, 31.454545454545457, 9.2727272727272734, 17.545454545454547, 25.545454545454543, 33.81818181818182, 187.90909090909091, 487.90909090909099, 294.90909090909093, 115.09090909090911, 42.272727272727273, 28.727272727272727, 15.90909090909091, 19.272727272727277, 19.000000000000004, 10.272727272727272, 18.999999999999996, 20.72727272727273, 21.545454545454543, 52.909090909090914, 200.81818181818181, 188.27272727272725, 111.8181818181818, 51.272727272727273, 30.545454545454543, 22.363636363636367, 30.000000000000007, 32.999999999999993, 39.454545454545453, 26.454545454545457, 27.363636363636363, 30.545454545454547, 30.999999999999996, 34.090909090909086, 32.81818181818182, 37.818181818181813, 40.45454545454546, 35.727272727272727, 37.81818181818182, 38.090909090909086, 42.545454545454554, 33.54545454545454, 40.909090909090907, 46.18181818181818, 35.545454545454554, 44.090909090909086, 39.363636363636367, 35.54545454545454, 39.545454545454547, 39.727272727272734, 41.818181818181827, 55.81818181818182, 119.90909090909091, 117.90909090909089, 93.454545454545467, 81.181818181818187, 77.545454545454547, 96.454545454545453, 202.81818181818181, 2442.7272727272725, 7586.0, 5550.090909090909, 2201.909090909091, 504.09090909090907, 145.09090909090909, 83.636363636363626, 72.545454545454547, 75.181818181818173, 68.27272727272728, 61.18181818181818, 52.727272727272734, 49.818181818181813, 63.0, 70.181818181818187, 62.909090909090907, 47.454545454545446, 44.909090909090907, 53.0, 46.545454545454533, 51.727272727272727, 55.454545454545453, 59.0, 34.81818181818182, 46.454545454545453, 55.909090909090914, 42.727272727272727, 51.545454545454547, 41.909090909090899, 44.454545454545453, 44.45454545454546, 47.81818181818182, 49.36363636363636, 48.72727272727272, 45.909090909090907, 52.181818181818187, 50.909090909090907, 68.909090909090907, 53.45454545454546, 68.27272727272728, 103.81818181818184, 112.72727272727273, 72.454545454545439, 59.909090909090914, 58.0, 42.181818181818173, 50.454545454545453, 61.909090909090914, 56.63636363636364, 50.909090909090899, 58.363636363636367, 51.090909090909086, 39.818181818181813, 47.454545454545453, 52.545454545454547, 53.63636363636364, 47.18181818181818, 42.0, 34.454545454545453, 53.454545454545453, 63.636363636363633, 53.0, 52.181818181818173, 48.090909090909086, 46.999999999999993, 52.727272727272727, 54.45454545454546, 57.727272727272727, 52.727272727272712, 50.818181818181813, 72.000000000000014, 69.909090909090907, 111.81818181818183, 706.90909090909076, 3332.272727272727, 3024.727272727273, 1340.3636363636363, 341.0, 116.90909090909091, 76.63636363636364, 75.727272727272734, 67.545454545454561, 73.63636363636364, 67.363636363636374, 54.272727272727266, 53.454545454545453, 55.727272727272734, 50.909090909090907, 82.63636363636364, 136.09090909090909, 110.90909090909092, 73.818181818181813, 54.545454545454547, 56.909090909090914, 43.81818181818182, 55.818181818181813, 54.63636363636364, 57.727272727272727, 54.36363636363636, 53.818181818181813, 55.181818181818187, 47.0, 53.818181818181813, 43.090909090909093, 49.999999999999993, 47.909090909090914, 38.363636363636367, 52.63636363636364, 57.545454545454554, 46.636363636363633, 52.36363636363636, 57.181818181818173, 50.090909090909093, 41.63636363636364, 49.545454545454554, 55.727272727272734, 53.545454545454547, 55.545454545454547, 56.18181818181818, 83.545454545454561, 47.909090909090899, 54.727272727272734, 55.909090909090907, 44.0, 52.363636363636353, 51.909090909090914, 53.000000000000007, 60.363636363636367, 52.454545454545453, 52.636363636363633, 51.72727272727272, 49.909090909090907, 77.0, 221.09090909090909, 238.81818181818184, 144.81818181818181, 72.090909090909079, 53.090909090909093, 57.636363636363626, 103.54545454545456, 390.36363636363637, 1338.090909090909, 1132.3636363636365, 525.09090909090912, 134.45454545454544, 56.72727272727272, 44.727272727272727, 36.63636363636364, 38.909090909090907, 36.090909090909093, 36.909090909090907, 38.36363636363636, 32.636363636363633, 33.000000000000007, 19.636363636363637, 19.272727272727273, 11.363636363636363, 20.272727272727273, 18.54545454545455, 21.181818181818183, 18.090909090909093, 12.81818181818182, 15.636363636363635, 10.727272727272727, 12.454545454545455, 7.8181818181818175, 5.1818181818181817, 0.63636363636363613, -1.7272727272727271, 1.8181818181818188, -8.2727272727272734, -8.5454545454545467, -3.8181818181818175, -4.9090909090909092, -3.2727272727272716, -8.7272727272727266, -7.8181818181818183, -14.909090909090908, -12.272727272727273, -18.18181818181818, -24.0, -19.727272727272727, -28.272727272727273, -28.27272727272727, -22.363636363636363, -26.454545454545453, -30.63636363636364, -27.545454545454547, -29.36363636363636, -28.0, -32.000000000000007, -42.54545454545454, -27.181818181818183, 19.0, 19.272727272727273, -9.5454545454545467, -31.90909090909091, -40.818181818181813, -45.636363636363633, -50.090909090909093, -54.363636363636367, -57.454545454545453, -54.363636363636353, -49.636363636363626, -47.545454545454554, -42.81818181818182, -47.090909090909093, -47.72727272727272, -44.727272727272727, -34.909090909090907, 52.272727272727273, 1335.9090909090908, 1980.3636363636365, 1168.9090909090908, 273.90909090909088, 16.454545454545457, -36.363636363636367, -48.63636363636364, -53.636363636363633, -52.0, -56.545454545454547, -59.63636363636364, -66.909090909090907, -52.636363636363626, -62.272727272727266, -63.636363636363633, -67.181818181818187, -66.454545454545453, -59.18181818181818, -60.454545454545453, -69.090909090909093, -68.363636363636374, -76.363636363636374, -76.36363636363636, -66.818181818181813, -68.818181818181813, -70.909090909090907, -68.63636363636364, -71.909090909090907, -68.545454545454547, -77.545454545454547, -71.818181818181827, -73.0, -72.0, -75.454545454545453, -77.27272727272728, -73.36363636363636, -65.454545454545453, -78.63636363636364, -68.454545454545453, -82.545454545454533, -75.36363636363636, -67.545454545454547, -65.363636363636374, -69.36363636363636, -72.454545454545453, -69.090909090909093, -64.72727272727272, -80.636363636363626, -81.63636363636364, -78.818181818181813, -77.909090909090921, -76.909090909090907, -67.363636363636346, -78.72727272727272, -73.545454545454547, -74.272727272727266, -73.818181818181813, -78.636363636363626, -66.72727272727272, -66.272727272727266, -56.090909090909093, 40.272727272727266, 943.90909090909088, 1131.5454545454545, 574.09090909090901, 72.454545454545467, -35.272727272727273, -52.36363636363636, -66.272727272727266, -66.72727272727272, -72.454545454545453, -72.36363636363636, -77.909090909090921, -86.090909090909079, -86.72727272727272, -80.454545454545453, -74.454545454545453, -69.818181818181813, -52.18181818181818, -51.545454545454561, -60.181818181818187, -68.454545454545467, -86.545454545454547, -76.454545454545467, -84.181818181818187, -80.545454545454533, -75.818181818181827, -81.636363636363654, -70.27272727272728, -76.545454545454561, -74.454545454545453, -80.818181818181813, -80.36363636363636, -82.181818181818187, -74.63636363636364, -84.545454545454547, -81.181818181818187, -75.545454545454547, -73.454545454545453, -87.0, -77.818181818181827, -78.545454545454547, -77.636363636363626, -75.454545454545453, -75.727272727272748, -79.727272727272734, -71.090909090909093, -60.909090909090914, -71.545454545454533, -76.545454545454547, -69.27272727272728, -71.63636363636364, -73.090909090909093, -80.545454545454561, -70.727272727272734, -71.0, -78.909090909090907, -73.090909090909079, -71.363636363636374, -70.27272727272728, -75.818181818181813, -75.0, -76.27272727272728, -79.181818181818173, -73.545454545454547, -76.818181818181827, -79.545454545454561, -76.181818181818159, -74.0, -76.909090909090907, -84.545454545454547, -67.090909090909093, -66.090909090909093, -66.36363636363636, -71.090909090909079, -72.272727272727266, -74.27272727272728, -79.63636363636364, -75.181818181818173, -75.181818181818187, -74.454545454545453, -75.818181818181813, -79.72727272727272, -77.818181818181813, -76.818181818181813, -78.181818181818187, -77.0, -73.181818181818187, -75.0, -72.181818181818173, -69.181818181818187, -75.909090909090907, -74.090909090909079, -78.909090909090907, -78.272727272727266, -70.909090909090907, -69.727272727272734, -70.63636363636364, -75.090909090909093, -77.727272727272734, -60.818181818181813, -67.909090909090907, -74.454545454545453, -78.545454545454547, -77.63636363636364, -78.0, -65.999999999999986, -71.090909090909093, -72.818181818181813, -76.272727272727266, -73.909090909090907, -76.0, -75.545454545454547, -78.909090909090921, -77.0, -80.545454545454547, -81.090909090909079, -72.63636363636364, -79.72727272727272, -69.090909090909093, -67.090909090909093, -74.454545454545467, -67.727272727272734, -73.727272727272734, -65.181818181818187, -71.545454545454533, -75.363636363636374, -81.72727272727272, -71.909090909090907, -73.090909090909093, -65.0, -68.181818181818187, -67.72727272727272, -74.181818181818187, -74.636363636363626, -66.909090909090921, -72.181818181818187, -72.818181818181827, -68.090909090909093, -64.363636363636374, -65.36363636363636, -67.090909090909079, -67.0, -74.909090909090921, -69.454545454545453, -62.999999999999993, -73.72727272727272, -67.909090909090892, -66.363636363636374, -62.909090909090899, -62.454545454545453, -9.545454545454545, 238.54545454545456, 228.45454545454544, 28.272727272727273, -54.818181818181813, -71.0, -67.272727272727266, -66.0, -65.0, -69.181818181818173, -69.545454545454533, 1101.090909090909, -345.63636363636368, -279.63636363636363, -108.54545454545453, -85.909090909090907, -89.363636363636374, -80.454545454545453, -75.454545454545453, -75.818181818181813, -82.36363636363636, -81.909090909090907, -81.818181818181827, -78.090909090909093, -78.272727272727266, -79.909090909090921, -79.272727272727266, -84.454545454545467, -85.36363636363636, -77.72727272727272, -79.454545454545439, -75.27272727272728, -75.181818181818187, -71.272727272727266, -79.818181818181813, -85.272727272727266, -77.090909090909079, -78.545454545454533, -78.090909090909108, -84.181818181818187, -78.36363636363636, -71.36363636363636, -79.727272727272734, -80.363636363636374, -75.72727272727272, -73.0, -71.27272727272728, -81.181818181818173, -71.181818181818187, -72.090909090909093, -73.272727272727266, -76.090909090909093, -78.727272727272734, -72.818181818181813, -71.818181818181827, -79.272727272727266, -80.727272727272734, -76.545454545454547, -78.636363636363626, -78.0, -65.36363636363636, -64.363636363636374, -69.454545454545467, -73.636363636363626, -74.454545454545453, -73.272727272727266, -71.0, -70.818181818181827, -71.0, -77.36363636363636, -57.18181818181818, -67.63636363636364, -68.36363636363636, -65.909090909090907, -73.36363636363636, -64.181818181818173, -64.181818181818173, -63.636363636363626, -64.545454545454547, -64.909090909090907, -64.0, -70.0, -68.0, -65.545454545454533, -64.909090909090907, -64.181818181818187, -67.272727272727266, -70.181818181818173, -64.63636363636364, -62.272727272727273, -54.36363636363636, -60.000000000000007, -60.727272727272727, -62.090909090909093, -61.81818181818182, -56.090909090909086, -50.909090909090907, -58.181818181818173, -62.181818181818187, -55.545454545454533, -59.909090909090907, -51.181818181818187, -54.454545454545453, -52.727272727272727, -60.454545454545453, -57.72727272727272, -62.363636363636367, -54.909090909090907, -56.363636363636374, -53.272727272727266, -55.545454545454547, -63.63636363636364, -56.72727272727272, -51.63636363636364, -42.727272727272727, -50.272727272727273, -51.272727272727266, -51.999999999999993, -57.454545454545453, -49.545454545454554, -43.454545454545453, -47.272727272727273, -48.36363636363636, -50.545454545454547, -47.909090909090907, -42.54545454545454, -42.454545454545453, -43.454545454545453, -44.818181818181827, -45.272727272727273, -50.727272727272734, -42.272727272727266, -39.727272727272727, -42.45454545454546, -45.36363636363636, -39.090909090909093, -38.363636363636367, -41.545454545454547, -33.454545454545446, -33.72727272727272, -32.909090909090907, -16.272727272727273, 24.36363636363636, -0.45454545454545436, -19.363636363636367, -22.09090909090909, -20.0, -5.4545454545454533, 66.72727272727272, 1090.7272727272727, 1765.6363636363635, 586.09090909090889, 76.727272727272734, -6.6363636363636367, -9.0, -33.545454545454547, -17.0, 8.7272727272727231, -30.454545454545453, -19.090909090909093, -20.72727272727273, -18.545454545454547, -15.81818181818182, -12.818181818181818, -20.818181818181817, -16.90909090909091, -24.545454545454543, -19.818181818181824, -15.90909090909091, -4.9999999999999991, -8.4545454545454568, -14.727272727272727, -10.0, -14.09090909090909, -12.090909090909092, -15.818181818181817, -6.9090909090909109, 2.1818181818181817, 0.36363636363636292, -7.6363636363636358, -10.272727272727272, -7.2727272727272725, -5.6363636363636367, -0.81818181818181834, -0.81818181818181879, 4.9999999999999991, -4.6363636363636358, 0.18181818181818232, 6.8181818181818183, 3.1818181818181817, -7.3636363636363615, -4.3636363636363633, 5.5454545454545459, 0.54545454545454541, 5.0909090909090917, 10.454545454545453, 14.090909090909092, 7.6363636363636358, 10.0, 13.727272727272727, 11.545454545454547, 13.18181818181818, 11.90909090909091, 19.90909090909091, 14.09090909090909, 11.454545454545453, 16.818181818181817, 17.090909090909093, 19.09090909090909, 17.09090909090909, 22.72727272727273, 22.454545454545453, 17.63636363636364, 26.090909090909093, 35.909090909090914, 30.727272727272727, 27.545454545454547, 28.090909090909086, 26.545454545454547, 25.36363636363636, 29.818181818181817, 29.54545454545455, 31.909090909090907, 28.181818181818183, 39.727272727272727, 37.727272727272727, 35.0, 45.545454545454547, 50.0, 44.363636363636367, 44.545454545454554, 34.454545454545453, 39.45454545454546, 34.727272727272727, 44.727272727272727, 47.454545454545453, 46.181818181818187, 52.45454545454546, 47.36363636363636, 47.36363636363636, 50.636363636363633, 54.545454545454547, 54.818181818181813, 56.81818181818182, 54.18181818181818, 54.272727272727266, 74.72727272727272, 66.636363636363626, 58.27272727272728, 60.363636363636367, 63.727272727272741, 53.545454545454547, 66.545454545454547, 72.181818181818173, 78.454545454545453, 80.909090909090921, 80.0, 75.090909090909079, 75.545454545454561, 81.181818181818187, 85.363636363636374, 93.545454545454547, 92.090909090909093, 95.0, 81.545454545454533, 92.545454545454561, 88.454545454545439, 95.36363636363636, 98.818181818181813, 97.454545454545453, 105.09090909090911, 239.09090909090909, 251.90909090909093, 142.36363636363637, 112.54545454545455, 116.90909090909091, 105.09090909090909, 96.454545454545453, 103.0, 115.09090909090909, 116.45454545454545, 107.99999999999999, 117.90909090909092, 117.72727272727273, 121.45454545454547, 128.90909090909091, 132.27272727272725, 117.72727272727272, 121.81818181818181, 125.81818181818181, 122.09090909090909, 132.99999999999997, 139.81818181818181, 143.18181818181819, 152.18181818181819, 147.63636363636363, 144.09090909090909, 152.63636363636363, 150.90909090909091, 148.18181818181819, 163.90909090909091, 187.54545454545453, 160.27272727272725, 150.36363636363637, 156.63636363636363, 170.72727272727272, 156.45454545454544, 172.18181818181816, 180.4545454545455, 159.18181818181819, 161.45454545454547, 172.90909090909091, 179.54545454545456, 172.27272727272731, 176.72727272727269, 189.18181818181819, 177.90909090909091, 176.0, 171.63636363636365, 171.90909090909093, 180.27272727272728, 195.90909090909091, 181.90909090909091, 192.09090909090912, 179.27272727272728, 188.18181818181819, 203.4545454545455, 188.90909090909096, 205.81818181818181, 212.45454545454547, 213.0, 214.63636363636363, 209.27272727272728, 207.72727272727269, 207.36363636363635, 198.27272727272728, 218.90909090909088, 229.63636363636363, 214.72727272727272, 223.6363636363636, 231.63636363636365, 237.18181818181819, 241.09090909090909, 248.09090909090907, 248.3636363636364, 241.72727272727269, 254.09090909090907, 255.90909090909091, 258.36363636363637, 280.90909090909093, 262.81818181818181, 262.18181818181819, 281.81818181818181, 289.54545454545456, 267.5454545454545, 265.0, 249.63636363636365, 294.36363636363637, 287.72727272727275, 292.27272727272725, 299.18181818181819, 305.09090909090912, 315.72727272727275, 280.72727272727275, 297.63636363636363, 288.81818181818181, 314.45454545454544, 311.27272727272731, 305.27272727272725, 316.45454545454544, 322.4545454545455, 324.45454545454544, 329.72727272727269, 342.54545454545456, 356.45454545454544, 340.72727272727275, 355.45454545454538, 315.63636363636363, 336.00000000000006, 340.09090909090912, 329.90909090909093, 358.18181818181824, 373.36363636363632, 395.63636363636363, 367.27272727272725, 322.81818181818181, 348.72727272727275, 387.90909090909093, 394.5454545454545, 369.36363636363632, 355.0, 375.63636363636368, 387.18181818181813, 405.18181818181813, 409.27272727272725, 397.72727272727275, 411.90909090909088, 413.54545454545462, 417.54545454545456, 432.36363636363643, 423.4545454545455, 429.81818181818181, 442.63636363636363, 442.09090909090907, 443.90909090909088, 464.0, 476.90909090909082, 449.54545454545462, 455.72727272727275, 468.5454545454545, 482.36363636363637, 460.0, 483.36363636363637, 456.27272727272725, 504.27272727272725, 483.72727272727269, 487.36363636363637, 501.72727272727269, 507.36363636363637, 525.72727272727275, 525.18181818181824, 526.27272727272725, 517.27272727272725, 502.81818181818176, 564.63636363636363, 563.72727272727275, 550.81818181818187, 524.81818181818176, 548.27272727272725, 551.5454545454545, 594.63636363636363, 543.72727272727275, 607.90909090909088, 592.90909090909088, 597.5454545454545, 601.36363636363637, 617.45454545454538, 653.90909090909088, 633.63636363636363, 624.5454545454545, 647.81818181818176, 662.81818181818176, 645.63636363636363, 602.4545454545455, 669.63636363636363, 939.5454545454545, 817.90909090909099, 1999.4545454545455, 820.54545454545462, 653.99999999999989, 652.63636363636351, 704.63636363636351, 658.0, 664.81818181818187, 703.90909090909099, 722.54545454545473, 726.4545454545455, 737.18181818181813, 734.36363636363626, 749.81818181818187, 727.63636363636374, 707.81818181818176, 732.63636363636363, 671.18181818181824, 723.90909090909099, 760.81818181818176, 748.27272727272737, 734.00000000000011, 744.81818181818187, 750.18181818181813, 742.4545454545455, 785.81818181818187, 789.4545454545455, 795.63636363636363, 819.27272727272725, 822.0, 822.63636363636363, 856.81818181818176, 838.36363636363637, 814.63636363636363, 790.99999999999989, 787.45454545454538, 813.4545454545455, 808.4545454545455, 845.36363636363637, 853.18181818181813, 856.18181818181813, 824.63636363636374, 866.27272727272714, 869.27272727272725, 821.18181818181813, 843.63636363636351, 867.27272727272725, 859.09090909090912, 936.0, 828.90909090909099, 892.63636363636374, 867.09090909090901, 889.45454545454538, 896.18181818181824, 837.27272727272737, 908.27272727272714, 934.63636363636363, 905.81818181818187, 915.27272727272725, 921.0, 955.27272727272725, 988.81818181818176, 985.54545454545462, 968.00000000000011, 1038.909090909091, 1024.1818181818182, 952.72727272727275, 1031.5454545454547, 1068.1818181818182, 1054.8181818181818, 1037.727272727273, 1065.8181818181818, 1090.4545454545455, 1132.0909090909092, 1128.6363636363637, 1137.0, 1137.0]

tol = 0.03   # max dif

# plt.plot(x_pix, ar_i, label='Ar')
# plt.plot(x_pix, xe_i, label='Xe')
# plt.legend()
# plt.show()

# ar_mf = mf(ar_i, 31)
# plt.plot(ar_mf)
# plt.show()
#
# plt.plot(ar_i - ar_mf)
# plt.show()

# matched by eye
xpos_m = [11.0, 71.0, 127.0, 204.0, 213.5, 269.0, 292.0, 313.0, 365.0, 413.0, 606.0, 621.0, 724.0, 779.0]
ang_m = [1.409749, 1.46532, 1.517684, 1.590403, 1.599386, 1.652437, 1.674465, 1.694521, 1.744967, 1.79209, 1.982292,
       1.997118, 2.099184, 2.154008]

hk_range, zj_range = [1.388, 2.419], [0.887, 1.531]     # microns

# initial guess - linear over whole detector range
z = np.polyfit(x_pix, np.linspace(hk_range[0], hk_range[1], 1024), 1)
sol = np.poly1d(z)
y_sol = sol(x_pix)      # wavelength of each pixel
# plt.plot(x_pix, y_sol, color='k', ls='--')


# cookbook - Ar
lines_ar = [14097.5, 14654.3, 14260.8, 15050.6, 15176.8, 15306.1, 15904.0, 15993.9, 16127.1, 16184.4, 16441.1, 16524.4,
         16744.6, 16945.2, 17449.7, 17919.6, 18434.5, 19971.2, 19822.9, 20322.6, 20621.9, 20991.8, 21540.1,
         22083.2, 23139.5]
lines_ar = np.asarray(lines_ar) / 1e4

# cookbook - Xe
lines_xe = [14244.8, 14738.8, 15422.6, 16057.7, 16732.6, 17330.5, 18793.2, 20267.8, 21475.9, 23199.6]
lines_xe = np.asarray(lines_xe) / 1e4

ar_mf = ar_i - mf(ar_i, 21)
xe_mf = xe_i - mf(xe_i, 21)

lines_both = [lines_ar, lines_xe]
mf_both = [ar_mf, xe_mf]

x_g, w_g, l_g, dif = [], [], [], []
for arc in range(2):
    xpos = list(detect_peaks.detect_peaks(mf_both[arc], mpd=7, threshold=150.0))
    lines = lines_both[arc]

    print len(xpos)

    for i in range(len(xpos)):      # loop x positions of lines
        pix = xpos[i]               # pixel number
        wav_guess = sol(pix)        # guess Ar line

        li = np.argmin(abs(np.asarray(lines) - wav_guess))      # closest line to guess
        line_i = lines[li]
        dif_i = abs(wav_guess - lines[li])      # wavelength difference between guess and matched line

        # print wav_guess, ang[i], lines[li]

        if dif_i < tol and int(pix) not in [512, 513]:     # if match close to guess & not the chip crossover
            done = line_i in l_g    # if line already matched to a pixel
            if done:
                j = np.argmin(abs(w_g - wav_guess))     # index in x_g, w_g, l_g, dif
                line_j = l_g[j]
                dif_j = dif[j]

                if dif_i < dif_j:   # if new pixel closer
                    for lis in [x_g, w_g, l_g, dif]:
                        del lis[j]

                    x_g.append(pix)         # pixel number
                    w_g.append(wav_guess)   # guess value
                    l_g.append(line_i)      # line value matched
                    dif.append(dif_i)       # difference between guess and line matched

            else:
                x_g.append(pix)         # pixel number
                w_g.append(wav_guess)   # guess value
                l_g.append(line_i)      # line value matched
                dif.append(dif_i)       # difference between guess and line matched

            # print pix, round(wav_guess, 6), ang[i], line_i, dif_i

    print len(x_g)

z = np.polyfit(xpos_m, ang_m, 3)
sol = np.poly1d(z)
xposang_m = sol(x_pix)

z = np.polyfit(x_g, l_g, 3)
sol = np.poly1d(z)
xglg = sol(x_pix)

[plt.axhline(aw, color='k') for aw in lines_ar]
[plt.axhline(aw, color='k') for aw in lines_xe]
# [plt.axvline(aw, color='k') for aw in xpos]
plt.plot(xpos_m, ang_m, '.')
plt.plot(x_pix, xposang_m, color='#1f77b4', alpha=0.7, label='Manual')
plt.plot(x_g, l_g, '.')
plt.plot(x_pix, xglg, color='#ff7f0e', alpha=0.7, label='Auto')
plt.legend()
plt.show()

fitdif = []
for i in range(len(x_g)):
    x = int(x_g[i])
    fit = sol(x)
    y = l_g[i]
    fitdif.append(y - fit)

plt.plot(x_g, fitdif, 'o')
plt.axhline(0, color='k')
plt.show()
