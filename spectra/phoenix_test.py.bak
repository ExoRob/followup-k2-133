from astropy.io import fits
import matplotlib.pyplot as plt
import numpy as np
import glob
from astropy.convolution import convolve
from pysynphot import observation
from pysynphot import spectrum


def rebin_spec(wave, specin, wavnew):
    spec = spectrum.ArraySourceSpectrum(wave=wave, flux=specin)
    f = np.ones(len(wave))
    filt = spectrum.ArraySpectralElement(wave, f, waveunits='micron')
    obs = observation.Observation(spec, filt, binset=wavnew, force='taper')

    return obs.binflux


def load_model_spec(fname, wav_lims, cut=False):
    model_file = np.genfromtxt(fname, delimiter='  ', dtype=float)

    model_wav_full, model_spec_full = model_file[:, 0] / 1e4, model_file[:, 1]

    # print len(model_wav_full)

    model_wav, model_spec= [], []
    for i in range(len(model_spec_full)):
        if wav_lims[0] < model_wav_full[i] < wav_lims[1]:
            if cut:
                if i % 2 == 0:
                    model_wav.append(model_wav_full[i])
                    model_spec.append(model_spec_full[i])
            else:
                model_wav.append(model_wav_full[i])
                model_spec.append(model_spec_full[i])

    # print len(model_wav)

    if cut:
        model_wav, model_spec = model_wav[7:], model_spec[7:]

    return np.asarray(model_wav), np.asarray(model_spec) / np.nanmedian(model_spec)

# fw = fits.open('wavegrid.fits')
# fs = fits.open('spec.fits')
#
# hw = fw[0].header
# hs = fs[0].header
#
# # for thing in hw:
# #     print thing, hw[thing]
# # print '\n\n'
# # for thing in hs:
# #     print thing, hs[thing]
#
# print fw[0].data
#
# wav = np.asarray(fw[0].data) / 1e4
# spec = fs[0].data
#
# plt.plot(wav, spec)
# plt.xlim(0.8, 2.6)
# plt.show()

# for t in [9600]:#range(9000, 10001, 200):
#     if t < 10000:
#         tt = '0' + str(t)
#     else:
#         tt = str(t)
#
#     f_a0 = fits.open('PHOENIX-ACES-AGSS-COND-2011_R10000FITS_Z-0.0/' +
#                      'lte'+tt+'-4.00-0.0.PHOENIX-ACES-AGSS-COND-2011-HiRes.fits')
#
#     spec_a0 = f_a0[0].data / np.nanmedian(f_a0[0].data)  # phoenix model for A0V
#
#     wav = np.linspace(0.3, 2.5, len(spec_a0))  # wavelength grid of models
#
#     plt.plot(wav, spec_a0, alpha=0.7, label=t)
# # plt.xlim(0.9, 1.5)
# plt.legend()
# plt.show()

# f_m1 = fits.open('PHOENIX-ACES-AGSS-COND-2011_R10000FITS_Z-0.0/' +
#                  'lte03600-5.00-0.0.PHOENIX-ACES-AGSS-COND-2011-HiRes.fits')

f_a0_med = fits.open('PHOENIX-ACES-AGSS-COND-2011_R10000FITS_Z-0.0/' +
                     'lte09400-4.00-0.0.PHOENIX-ACES-AGSS-COND-2011-HiRes.fits')

f_a0 = fits.open('a0_spec.fits')
fw = fits.open('wavegrid.fits')
wav = fw[0].data / 1e4

h = f_a0[0].header
for thing in h:
    print thing, h[thing]
# print fw.info()

# spec_m1 = f_m1[0].data / np.nanmedian(f_m1[0].data)      # phoenix model for M1V
spec_a0 = f_a0[0].data / np.nanmax(f_a0[0].data)      # phoenix model for A0V

wav_ex = [0.88926899938398984, 0.88983706793181983, 0.89040528149028231, 0.89097363988397227, 0.89154214293748435, 0.89211079047541375, 0.89267958232235534, 0.89324851830290386, 0.89381759824165441, 0.89438682196320185, 0.89495618929214105, 0.89552570005306709, 0.89609535407057461, 0.89666515116925882, 0.89723509117371447, 0.89780517390853654, 0.89837539919831988, 0.89894576686765937, 0.89951627674115009, 0.90008692864338691, 0.90065772239896469, 0.9012286578324783, 0.90179973476852282, 0.90237095303169301, 0.90294231244658396, 0.90351381283779031, 0.90408545402990725, 0.90465723584752955, 0.90522915811525229, 0.9058012206576701, 0.9063734232993782, 0.90694576586497133, 0.90751824817904447, 0.90809087006619249, 0.90866363135101036, 0.90923653185809294, 0.90980957141203522, 0.91038274983743206, 0.91095606695887843, 0.9115295226009692, 0.91210311658829935, 0.91267684874546362, 0.91325071889705722, 0.9138247268676748, 0.91439887248191143, 0.91497315556436198, 0.91554757593962133, 0.91612213343228444, 0.91669682786694628, 0.91727165906820163, 0.91784662686064555, 0.91842173106887293, 0.91899697151747861, 0.91957234803105758, 0.92014786043420471, 0.92072350855151486, 0.92129929220758311, 0.92187521122700433, 0.92245126543437339, 0.92302745465428515, 0.92360377871133459, 0.92418023743011668, 0.92475683063522629, 0.9253335581512584, 0.92591041980280775, 0.92648741541446944, 0.92706454481083833, 0.92764180781650929, 0.92821920425607729, 0.92879673395413731, 0.9293743967352841, 0.92995219242411276, 0.93053012084521802, 0.93110818182319488, 0.93168637518263842, 0.93226470074814327, 0.93284315834430453, 0.93342174779571707, 0.93400046892697586, 0.93457932156267565, 0.93515830552741164, 0.93573742064577847, 0.93631666674237124, 0.9368960436417848, 0.93747555116861403, 0.93805518914745389, 0.93863495740289926, 0.93921485575954522, 0.93979488404198641, 0.94037504207481803, 0.94095532968263473, 0.94153574669003171, 0.94211629292160359, 0.9426969682019456, 0.94327777235565236, 0.94385870520731896, 0.94443976658154027, 0.94502095630291127, 0.94560227419602683, 0.94618372008548179, 0.94676529379587115, 0.94734699515178988, 0.94792882397783285, 0.94851078009859491, 0.94909286333867104, 0.94967507352265612, 0.95025741047514511, 0.95083987402073289, 0.95142246398401453, 0.95200518018958469, 0.95258802246203844, 0.95317099062597066, 0.95375408450597643, 0.95433730392665039, 0.95492064871258753, 0.95550411868838292, 0.95608771367863143, 0.95667143350792783, 0.95725527800086718, 0.95783924698204437, 0.95842334027605425, 0.9590075577074918, 0.95959189910095199, 0.96017636428102959, 0.96076095307231968, 0.96134566529941712, 0.96193050078691678, 0.96251545935941352, 0.96310054084150243, 0.96368574505777826, 0.96427107183283611, 0.96485652099127073, 0.9654420923576772, 0.96602778575665027, 0.96661360101278493, 0.96719953795067615, 0.96778559639491868, 0.96837177617010772, 0.96895807710083792, 0.96954449901170425, 0.9701310417273018, 0.97071770507222521, 0.97130448887106968, 0.97189139294842997, 0.97247841712890093, 0.97306556123707766, 0.97365282509755502, 0.97424020853492788, 0.97482771137379121, 0.97541533343873976, 0.97600307455436874, 0.97659093454527279, 0.977178913236047, 0.97776701045128622, 0.97835522601558544, 0.97894355975353942, 0.97953201148974323, 0.98012058104879174, 0.98070926825527993, 0.98129807293380256, 0.98188699490895459, 0.98247603400533112, 0.98306519004752679, 0.9836544628601368, 0.9842438522677559, 0.98483335809497896, 0.98542298016640095, 0.98601271830661696, 0.98660257234022164, 0.98719254209181007, 0.98778262738597711, 0.98837282804731774, 0.98896314390042672, 0.98955357476989914, 0.99014412048032985, 0.99073478085631383, 0.99132555572244585, 0.99191644490332098, 0.99250744822353409, 0.99309856550768005, 0.99368979658035372, 0.9942811412661503, 0.99487259938966432, 0.99546417077549099, 0.99605585524822515, 0.99664765263246169, 0.99723956275279557, 0.99783158543382156, 0.99842372050013473, 0.99901596777633006, 0.99960832708700231, 1.0002007982567465, 1.0007933811101573, 1.00138607547183, 1.0019788811663592, 1.0025717980183402, 1.0031648258523675, 1.0037579644930363, 1.0043512137649415, 1.0049445734926776, 1.0055380435008403, 1.0061316236140236, 1.0067253136568233, 1.0073191134538337, 1.00791302282965, 1.0085070416088668, 1.0091011696160797, 1.0096954066758828, 1.0102897526128716, 1.0108842072516406, 1.0114787704167851, 1.0120734419328998, 1.0126682216245797, 1.0132631093164197, 1.0138581048330146, 1.0144532079989594, 1.0150484186388491, 1.0156437365772786, 1.0162391616388429, 1.0168346936481365, 1.0174303324297547, 1.0180260778082924, 1.0186219296083443, 1.0192178876545057, 1.0198139517713711, 1.0204101217835355, 1.0210063975155941, 1.0216027787921416, 1.0221992654377727, 1.022795857277083, 1.0233925541346667, 1.023989355835119, 1.0245862622030348, 1.025183273063009, 1.0257803882396368, 1.0263776075575126, 1.0269749308412317, 1.027572357915389, 1.0281698886045791, 1.0287675227333974, 1.0293652601264385, 1.0299631006082972, 1.0305610440035686, 1.0311590901368477, 1.0317572388327294, 1.0323554899158085, 1.03295384321068, 1.0335522985419385, 1.0341508557341796, 1.0347495146119976, 1.0353482749999876, 1.0359471367227446, 1.0365460996048634, 1.0371451634709392, 1.0377443281455667, 1.0383435934533405, 1.0389429592188562, 1.039542425266708, 1.0401419914214916, 1.0407416575078012, 1.0413414233502321, 1.041941288773379, 1.042541253601837, 1.0431413176602011, 1.0437414807730661, 1.0443417427650266, 1.0449421034606781, 1.0455425626846151, 1.0461431202614326, 1.0467437760157257, 1.0473445297720891, 1.0479453813551178, 1.0485463305894069, 1.049147377299551, 1.0497485213101452, 1.0503497624457843, 1.0509511005310632, 1.0515525353905772, 1.0521540668489207, 1.0527556947306889, 1.0533574188604766, 1.0539592390628789, 1.0545611551624905, 1.0551631669839066, 1.0557652743517216, 1.0563674770905309, 1.0569697750249294, 1.0575721679795118, 1.0581746557788732, 1.0587772382476084, 1.0593799152103121, 1.0599826864915796, 1.0605855519160057, 1.0611885113081854, 1.0617915644927132, 1.0623947112941845, 1.0629979515371941, 1.0636012850463368, 1.0642047116462077, 1.0648082311614013, 1.0654118434165132, 1.0660155482361378, 1.06661934544487, 1.067223234867305, 1.0678272163280376, 1.0684312896516626, 1.0690354546627749, 1.0696397111859697, 1.0702440590458417, 1.0708484980669861, 1.0714530280739973, 1.0720576488914708, 1.0726623603440009, 1.0732671622561831, 1.0738720544526119, 1.0744770367578824, 1.0750821089965896, 1.0756872709933283, 1.0762925225726934, 1.0768978635592799, 1.0775032937776825, 1.0781088130524963, 1.0787144212083164, 1.0793201180697374, 1.0799259034613542, 1.0805317772077621, 1.0811377391335557, 1.0817437890633299, 1.0823499268216796, 1.0829561522332001, 1.083562465122486, 1.0841688653141321, 1.0847753526327335, 1.0853819269028853, 1.085988587949182, 1.0865953355962188, 1.0872021696685905, 1.0878090899908921, 1.0884160963877185, 1.0890231886836648, 1.0896303667033256, 1.0902376302712957, 1.0908449792121704, 1.0914524133505445, 1.092059932511013, 1.0926675365181704, 1.0932752251966122, 1.0938829983709331, 1.0944908558657276, 1.0950987975055912, 1.0957068231151186, 1.0963149325189048, 1.0969231255415446, 1.0975314020076328, 1.0981397617417645, 1.0987482045685346, 1.0993567303125382, 1.0999653387983697, 1.1005740298506246, 1.1011828032938973, 1.1017916589527832, 1.1024005966518768, 1.1030096162157734, 1.1036187174690677, 1.1042279002363544, 1.104837164342229, 1.1054465096112858, 1.1060559358681201, 1.1066654429373268, 1.1072750306435006, 1.1078846988112365, 1.1084944472651297, 1.1091042758297747, 1.1097141843297667, 1.1103241725897004, 1.1109342404341709, 1.1115443876877731, 1.1121546141751018, 1.1127649197207519, 1.1133753041493186, 1.1139857672853966, 1.1145963089535806, 1.1152069289784661, 1.1158176271846474, 1.1164284033967198, 1.117039257439278, 1.1176501891369173, 1.1182611983142321, 1.1188722847958177, 1.1194834484062688, 1.1200946889701806, 1.1207060063121475, 1.121317400256765, 1.1219288706286277, 1.1225404172523303, 1.1231520399524684, 1.1237637385536363, 1.1243755128804291, 1.1249873627574418, 1.1255992880092691, 1.1262112884605062, 1.1268233639357481, 1.1274355142595893, 1.1280477392566248, 1.1286600387514498, 1.1292724125686591, 1.1298848605328475, 1.13049738246861, 1.1311099782005416, 1.1317226475532371, 1.1323353903512914, 1.1329482064192995, 1.1335610955818565, 1.1341740576635568, 1.1347870924889958, 1.1354001998827681, 1.1360133796694687, 1.1366266316736928, 1.137239955720035, 1.1378533516330902, 1.1384668192374536, 1.1390803583577198, 1.1396939688184839, 1.140307650444341, 1.1409214030598855, 1.1415352264897127, 1.1421491205584176, 1.1427630850905948, 1.1433771199108393, 1.1439912248437463, 1.1446053997139103, 1.1452196443459266, 1.1458339585643897, 1.1464483421938949, 1.1470627950590371, 1.147677316984411, 1.1482919077946114, 1.1489065673142336, 1.1495212953678724, 1.1501360917801227, 1.1507509563755793, 1.1513658889788372, 1.1519808894144914, 1.1525959575071365, 1.1532110930813677, 1.15382629596178, 1.1544415659729683, 1.1550569029395272, 1.1556723066860519, 1.1562877770371371, 1.1569033138173781, 1.1575189168513693, 1.158134585963706, 1.1587503209789831, 1.1593661217217954, 1.1599819880167379, 1.1605979196884053, 1.1612139165613928, 1.1618299784602952, 1.1624461052097073, 1.1630622966342243, 1.1636785525584408, 1.164294872806952, 1.1649112572043525, 1.1655277055752375, 1.1661442177442018, 1.1667607935358406, 1.1673774327747481, 1.1679941352855201, 1.1686109008927508, 1.1692277294210356, 1.1698446206949691, 1.1704615745391465, 1.1710785907781622, 1.1716956692366118, 1.1723128097390898, 1.1729300121101913, 1.1735472761745109, 1.1741646017566441, 1.1747819886811852, 1.1753994367727296, 1.1760169458558718, 1.1766345157552069, 1.17725214629533, 1.1778698373008358, 1.1784875885963193, 1.1791054000063752, 1.179723271355599, 1.1803412024685849, 1.1809591931699281, 1.1815772432842238, 1.1821953526360667, 1.1828135210500514, 1.1834317483507732, 1.1840500343628271, 1.1846683789108079, 1.1852867818193102, 1.1859052429129293, 1.1865237620162601, 1.1871423389538973, 1.187760973550436, 1.188379665630471, 1.1889984150185973, 1.1896172215394096, 1.1902360850175033, 1.1908550052774731, 1.1914739821439135, 1.19209301544142, 1.1927121049945872, 1.19333125062801, 1.1939504521662836, 1.1945697094340026, 1.1951890222557622, 1.1958083904561569, 1.1964278138597821, 1.1970472922912325, 1.1976668255751031, 1.1982864135359885, 1.1989060559984841, 1.1995257527871843, 1.2001455037266844, 1.2007653086415793, 1.2013851673564637, 1.2020050796959327, 1.2026250454845813, 1.2032450645470041, 1.2038651367077962, 1.2044852617915525, 1.205105439622868, 1.2057256700263377, 1.2063459528265561, 1.2069662878481184, 1.2075866749156197, 1.2082071138536545, 1.208827604486818, 1.2094481466397051, 1.2100687401369108, 1.2106893848030298, 1.2113100804626569, 1.2119308269403875, 1.2125516240608161, 1.2131724716485377, 1.2137933695281473, 1.2144143175242399, 1.2150353154614104, 1.2156563631642534, 1.2162774604573641, 1.2168986071653376, 1.2175198031127683, 1.2181410481242514, 1.2187623420243821, 1.2193836846377548, 1.2200050757889647, 1.2206265153026066, 1.2212480030032755, 1.2218695387155665, 1.2224911222640742, 1.2231127534733937, 1.2237344321681198, 1.2243561581728475, 1.2249779313121716, 1.2255997514106871, 1.226221618292989, 1.2268435317836723, 1.2274654917073315, 1.2280874978885619, 1.2287095501519585, 1.2293316483221157, 1.229953792223629, 1.2305759816810928, 1.2311982165191024, 1.2318204965622526, 1.2324428216351384, 1.2330651915623543, 1.2336876061684958, 1.2343100652781576, 1.2349325687159345, 1.2355551163064213, 1.2361777078742133, 1.2368003432439052, 1.2374230222400922, 1.2380457446873685, 1.2386685104103297, 1.2392913192335706, 1.2399141709816859, 1.2405370654792707, 1.2411600025509197, 1.2417829820212281, 1.2424060037147908, 1.2430290674562023, 1.2436521730700583, 1.2442753203809527, 1.2448985092134812, 1.2455217393922386, 1.2461450107418195, 1.2467683230868192, 1.2473916762518322, 1.2480150700614538, 1.2486385043402788, 1.249261978912902, 1.2498854936039183, 1.2505090482379229, 1.2511326426395104, 1.2517562766332759, 1.2523799500438142, 1.2530036626957204, 1.2536274144135893, 1.2542512050220158, 1.2548750343455948, 1.2554989022089214, 1.2561228084365901, 1.2567467528531964, 1.2573707352833348, 1.2579947555516002, 1.2586188134825878, 1.2592429089008923, 1.2598670416311086, 1.2604912114978317, 1.2611154183256568, 1.2617396619391783, 1.2623639421629913, 1.2629882588216907, 1.2636126117398718, 1.2642370007421291, 1.2648614256530575, 1.2654858862972522, 1.2661103824993079, 1.2667349140838196, 1.2673594808753821, 1.2679840826985904, 1.2686087193780393, 1.2692333907383242, 1.2698580966040396, 1.2704828367997802, 1.2711076111501414, 1.2717324194797177, 1.2723572616131045, 1.2729821373748964, 1.2736070465896883, 1.2742319890820752, 1.2748569646766521, 1.2754819731980136, 1.2761070144707551, 1.276732088319471, 1.2773571945687567, 1.2779823330432067, 1.2786075035674163, 1.2792327059659803, 1.2798579400634933, 1.2804832056845505, 1.2811085026537468, 1.2817338307956772, 1.2823591899349365, 1.2829845798961195, 1.2836100005038213, 1.2842354515826369, 1.284860932957161, 1.2854864444519885, 1.2861119858917145, 1.2867375571009338, 1.2873631579042415, 1.2879887881262322, 1.2886144475915011, 1.2892401361246431, 1.2898658535502527, 1.2904915996929254, 1.2911173743772557, 1.291743177427839, 1.2923690086692696, 1.2929948679261427, 1.2936207550230534, 1.2942466697845965, 1.2948726120353666, 1.2954985815999591, 1.2961245783029685, 1.2967506019689901, 1.2973766524226185, 1.2980027294884491, 1.298628832991076, 1.2992549627550949, 1.2998811186051002, 1.3005073003656873, 1.3011335078614508, 1.3017597409169854, 1.3023859993568865, 1.3030122830057487, 1.303638591688167, 1.3042649252287364, 1.3048912834520516, 1.3055176661827079, 1.3061440732452998, 1.3067705044644224, 1.3073969596646708, 1.3080234386706397, 1.3086499413069239, 1.3092764673981185, 1.3099030167688186, 1.3105295892436186, 1.311156184647114, 1.3117828028038994, 1.3124094435385696, 1.3130361066757199, 1.3136627920399448, 1.3142894994558394, 1.314916228747999, 1.3155429797410176, 1.3161697522594911, 1.3167965461280136, 1.3174233611711808, 1.318050197213587, 1.3186770540798274, 1.3193039315944968, 1.3199308295821901, 1.3205577478675024, 1.3211846862750285, 1.3218116446293633, 1.3224386227551019, 1.323065620476839, 1.3236926376191693, 1.3243196740066883, 1.3249467294639905, 1.3255738038156708, 1.3262008968863244, 1.3268280085005462, 1.327455138482931, 1.3280822866580733, 1.3287094528505687, 1.3293366368850119, 1.3299638385859975, 1.3305910577781208, 1.3312182942859767, 1.3318455479341598, 1.3324728185472654, 1.3331001059498884, 1.3337274099666232, 1.3343547304220651, 1.3349820671408092, 1.3356094199474502, 1.3362367886665829, 1.3368641731228024, 1.3374915731407035, 1.3381189885448814, 1.3387464191599305, 1.3393738648104463, 1.3400013253210232, 1.3406288005162565, 1.341256290220741, 1.3418837942590716, 1.342511312455843, 1.3431388446356505, 1.3437663906230888, 1.3443939502427529, 1.3450215233192377, 1.3456491096771379, 1.3462767091410488, 1.3469043215355652, 1.3475319466852818, 1.3481595844147936, 1.3487872345486955, 1.3494148969115827, 1.3500425713280499, 1.3506702576226921, 1.3512979556201041, 1.351925665144881, 1.3525533860216172, 1.3531811180749083, 1.3538088611293488, 1.3544366150095339, 1.3550643795400583, 1.3556921545455169, 1.3563199398505046, 1.3569477352796167, 1.3575755406574477, 1.3582033558085924, 1.3588311805576463, 1.3594590147292038, 1.3600868581478602, 1.36071471063821, 1.3613425720248484, 1.3619704421323704, 1.3625983207853707, 1.3632262078084441, 1.3638541030261859, 1.3644820062631906, 1.3651099173440535, 1.3657378360933694, 1.3663657623357333, 1.3669936958957398, 1.3676216365979839, 1.3682495842670608, 1.3688775387275651, 1.3695054998040921, 1.3701334673212364, 1.3707614411035929, 1.3713894209757567, 1.3720174067623228, 1.3726453982878857, 1.3732733953770406, 1.3739013978543824, 1.3745294055445061, 1.3751574182720063, 1.3757854358614783, 1.3764134581375167, 1.377041484924717, 1.3776695160476733, 1.378297551330981, 1.378925590599235, 1.37955363367703, 1.3801816803889613, 1.3808097305596234, 1.3814377840136114, 1.3820658405755202, 1.3826939000699447, 1.3833219623214801, 1.3839500271547209, 1.3845780943942623, 1.3852061638646989, 1.3858342353906259, 1.3864623087966383, 1.3870903839073305, 1.3877184605472981, 1.3883465385411355, 1.3889746177134379, 1.3896026978888003, 1.3902307788918171, 1.390858860547084, 1.3914869426791951, 1.3921150251127457, 1.3927431076723309, 1.3933711901825454, 1.3939992724679842, 1.3946273543532419, 1.3952554356629139, 1.3958835162215948, 1.3965115958538799, 1.3971396743843636, 1.397767751637641, 1.398395827438307, 1.3990239016109571, 1.3996519739801851, 1.400280044370587, 1.4009081126067571, 1.4015361785132903, 1.4021642419147817, 1.4027923026358264, 1.4034203605010189, 1.4040484153349544, 1.4046764669622278, 1.4053045152074339, 1.4059325598951677, 1.4065606008500242, 1.4071886378965983, 1.4078166708594846, 1.4084446995632782, 1.4090727238325744, 1.4097007434919675, 1.4103287583660529, 1.4109567682794253, 1.4115847730566795, 1.4122127725224107, 1.4128407665012137, 1.4134687548176832, 1.4140967372964144, 1.4147247137620023, 1.4153526840390414, 1.4159806479521271, 1.416608605325854, 1.417236555984817, 1.4178644997536112, 1.4184924364568317, 1.4191203659190728, 1.4197482879649299, 1.4203762024189976, 1.4210041091058714, 1.4216320078501454, 1.4222598984764152, 1.4228877808092752, 1.423515654673321, 1.4241435198931467, 1.4247713762933478, 1.4253992236985191, 1.4260270619332553, 1.4266548908221517, 1.4272827101898029, 1.4279105198608038, 1.4285383196597494, 1.4291661094112347, 1.4297938889398547, 1.4304216580702038, 1.4310494166268775, 1.4316771644344706, 1.4323049013175777, 1.4329326271007941, 1.4335603416087146, 1.4341880446659341, 1.4348157360970473, 1.4354434157266494, 1.4360710833793353, 1.4366987388796999, 1.4373263820523379, 1.4379540127218444, 1.4385816307128145, 1.4392092358498427, 1.4398368279575244, 1.440464406860454, 1.4410919723832267, 1.4417195243504375, 1.442347062586681, 1.4429745869165527, 1.4436020971646468, 1.4442295931555587, 1.4448570747138831, 1.445484541664215, 1.4461119938311495, 1.4467394310392812, 1.4473668531132051, 1.4479942598775162, 1.4486216511568093, 1.4492490267756795, 1.4498763865587216, 1.4505037303305306, 1.4511310579157013, 1.4517583691388287, 1.4523856638245076, 1.4530129417973332, 1.4536402028818998, 1.4542674469028032, 1.4548946736846378, 1.4555218830519983, 1.4561490748294803, 1.456776248841678, 1.4574034049131868, 1.4580305428686011, 1.4586576625325165, 1.4592847637295274, 1.4599118462842291, 1.4605389100212163, 1.4611659547650837, 1.4617929803404266, 1.4624199865718399, 1.4630469732839182, 1.4636739403012566, 1.4643008874484502, 1.4649278145500937, 1.465554721430782, 1.46618160791511, 1.4668084738276728, 1.4674353189930653, 1.468062143235882, 1.4686889463807185, 1.4693157282521692, 1.4699424886748294, 1.4705692274732933, 1.4711959444721567, 1.4718226394960141, 1.4724493123694606, 1.4730759629170906, 1.4737025909634998, 1.4743291963332825, 1.4749557788510337, 1.4755823383413484, 1.4762088746288218, 1.4768353875380487, 1.4774618768936234, 1.4780883425201417, 1.4787147842421979, 1.4793412018843872, 1.4799675952713047, 1.480593964227545, 1.4812203085777029, 1.4818466281463736, 1.4824729227581521, 1.4830991922376329, 1.4837254364094115, 1.4843516550980822, 1.4849778481282403, 1.4856040153244805, 1.486230156511398, 1.4868562715135876, 1.4874823601556439, 1.4881084222621623, 1.4887344576577375, 1.4893604661669644, 1.489986447614438, 1.4906124018247531, 1.4912383286225046, 1.4918642278322878, 1.4924900992786969, 1.4931159427863276, 1.4937417581797743, 1.494367545283632, 1.4949933039224956, 1.4956190339209605, 1.496244735103621, 1.4968704072950723, 1.4974960503199091, 1.4981216640027264, 1.4987472481681194, 1.499372802640683, 1.4999983272450115, 1.5006238218057004, 1.5012492861473445, 1.5018747200945386, 1.502500123471878, 1.5031254961039571, 1.503750837815371, 1.5043761484307148, 1.5050014277745829, 1.505626675671571, 1.5062518919462735, 1.5068770764232853, 1.5075022289272015, 1.508127349282617, 1.5087524373141266, 1.5093774928463253, 1.5100025157038082, 1.5106275057111698, 1.5112524626930053, 1.5118773864739095, 1.5125022768784775, 1.5131271337313041, 1.5137519568569842, 1.5143767460801127, 1.5150015012252844]     # wavelength of extracted spectrum
spec_a0_ex = np.asarray([1.1073225265511462, 1.1496180361468231, 0.45537544251909834, 0.91056456120737861, 1.3057574063722748, 1.4071175703372463, 1.3931432830258992, 1.3942612260108063, 1.3161915408980809, 1.2774361840879447, 1.2588038010061486, 1.3215949319918017, 1.3702254518352901, 1.2642071920998694, 1.2001117942984905, 1.1766349916154277, 1.0967020681945219, 1.0687534935718277, 1.0920439724240727, 0.92528414384199753, 0.92733370598099496, 0.89957145518911863, 0.86491522265697796, 0.89584497857275935, 1.0141606111421653, 1.0793739519284518, 1.1389975777901995, 1.1384386062977458, 1.0756474753120926, 1.0817961617290848, 1.1280044717719397, 1.2250791876280975, 1.1570709893795417, 1.1980622321594931, 1.1747717533072479, 1.1432830258990128, 1.1976895844978577, 1.2956959195081053, 1.2101732811626609, 1.1704863051984351, 1.2440842183715295, 1.2656977827464135, 1.1617290851499906, 1.1965716415129499, 1.2627166014533258, 1.2118501956400221, 1.2027203279299423, 1.2196757965343767, 1.2684926402086831, 1.2425936277249863, 1.2841438419973918, 1.2850754611514814, 1.2547046767281536, 1.2856344326439355, 1.3433948201975034, 1.2792994223961247, 1.232904788522452, 1.0814235140674495, 1.0965157443637046, 1.035401527855413, 1.0996832494876096, 1.1104900316750514, 1.1729085149990679, 1.2606670393143282, 1.2222843301658284, 1.3689211850195639, 1.3092975591578162, 1.2841438419973914, 1.27147382150177, 1.1725358673374324, 1.2776225079187626, 1.2291783119060928, 1.1727221911682504, 1.1132848891373208, 1.0454630147195827, 1.0122973728339855, 0.97670952114775489, 0.88895099683249501, 0.82038382709148505, 0.84330165828209414, 0.93609092602943922, 0.92658841065772313, 0.98099496925656782, 0.94186696478479603, 0.90944661822247086, 0.95807713806595862, 1.044158747903857, 1.2427799515558042, 1.3292342090553382, 1.2254518352897337, 1.152040245947457, 1.1391839016210172, 1.1062045835662384, 1.0266443078069685, 1.0260853363145148, 1.079373951928452, 0.98732997950437895, 1.092789267747345, 1.0804918949133595, 1.0396869759642258, 1.1006148686416992, 1.109372088690143, 1.0463946338736725, 1.0853363145146266, 1.1747717533072481, 1.0376374138252284, 0.96925656791503645, 1.1362027203279303, 1.1902366312651389, 1.0031675051239053, 0.98863424632010433, 0.95453698528041764, 0.97913173094838846, 0.89677659772684937, 0.8269051611701137, 0.87833053847587117, 0.97186510154648797, 1.0255263648220607, 1.115893422768772, 1.1801751444009689, 1.1287497670952116, 1.077138065958636, 1.1604248183342649, 1.1760760201229739, 1.2168809390721074, 1.246506428172163, 1.2342090553381777, 1.2217253586733743, 1.2591764486677848, 1.2630892491149623, 1.2535867337432456, 1.2537730575740638, 1.2576858580212409, 1.2656977827464133, 1.3092975591578164, 1.3575554313396683, 1.3605366126327556, 1.3446990870132292, 1.4613378051052732, 1.5666107695174216, 1.3996646171045273, 1.3787963480529164, 1.4238867151108625, 1.4574250046580959, 1.346189677659773, 1.3814048816843671, 1.2759455934414015, 1.2457611328488913, 1.2090553381777529, 1.3133966834358117, 1.3923979877026276, 1.3853176821315445, 1.305571082541457, 1.3223402273150739, 1.3994782932737098, 1.3590460219862122, 1.3737656046208315, 1.3566238121855785, 1.3882988634246323, 1.3543879262157634, 1.3174958077138066, 1.3959381404881683, 1.470467672815353, 1.4134525805850569, 1.5164896590273895, 1.4263089249114964, 1.4309670206819451, 1.4641326625675426, 1.4345071734674866, 1.4572386808272784, 1.5714551891186879, 1.5123905347493944, 1.4868641699273339, 1.503260667039314, 1.5097820011179426, 1.5032606670393149, 1.4926402086826904, 1.4917085895286006, 1.5658654741941498, 1.4598472144587291, 1.4009688839202534, 1.3797279672070057, 1.4790385690329795, 1.4300354015278556, 1.5125768585802124, 1.484628283957518, 1.4279858393888583, 1.4086081609837899, 1.3534563070616732, 1.4499720514253778, 1.4574250046580959, 1.4330165828209427, 1.3726476616359236, 1.4141978759083287, 1.3739519284516488, 1.4119619899385136, 1.374324576113285, 1.2861934041363894, 1.1576299608719958, 1.089062791130986, 1.0169554686044349, 1.1101173840134153, 1.2071920998695729, 1.2111049003167504, 1.3126513881125392, 1.3607229364635736, 1.3689211850195639, 1.3855040059623627, 1.3821501770076394, 1.3845723868082733, 1.390907397056083, 1.4030184460592512, 1.3048257872181852, 1.4421464505310229, 1.4311533445127638, 1.4473635177939259, 1.4175517048630522, 1.4494130799329237, 1.4279858393888583, 1.433389230482579, 1.4043227128749769, 1.457797652319732, 1.3983603502888025, 1.3227128749767096, 1.4382336500838462, 1.404695360536613, 1.3188000745295325, 1.3223402273150737, 1.3223402273150735, 1.4220234768026832, 1.3616545556176636, 1.4572386808272775, 1.3422768772125955, 1.3668716228805669, 1.3592323458170297, 1.3659400037264771, 1.4134525805850569, 1.3288615613937023, 1.3983603502888022, 1.4538848518725545, 1.3730203092975592, 1.4186696478479597, 1.3795416433761882, 1.4017141792435255, 1.3098565306502701, 1.4335755543133968, 1.4032047698900689, 1.3383640767654181, 1.4065585988447924, 1.3914663685485376, 1.4013415315818896, 1.438047326253028, 1.4339482019750327, 1.3942612260108069, 1.355133221539035, 1.4175517048630522, 1.3622135271101175, 1.3456307061673189, 1.3195453698528044, 1.3497298304453142, 1.3780510527296446, 1.4009688839202536, 1.4302217253586735, 1.3890441587479037, 1.3996646171045279, 1.4741941494317123, 1.4441960126700208, 1.4168064095397799, 1.3696664803428362, 1.3780510527296446, 1.321222284330166, 1.3828954723309113, 1.4391652692379358, 1.3392956959195084, 1.4400968883920255, 1.3296068567169745, 1.3847587106390908, 1.3365008384572385, 1.3603502888019379, 1.3318427426867898, 1.2606670393143282, 1.3966834358114402, 1.4320849636668531, 1.3735792807900133, 1.2794857462269424, 1.4214645053102291, 1.394074902179989, 1.4222098006335011, 1.3720886901434697, 1.3720886901434695, 1.3374324576113286, 1.273523383640768, 1.4455002794857459, 1.421650829141047, 1.4505310229178314, 1.4045090367057944, 1.3946338736724431, 1.3892304825787223, 1.4117756661076952, 1.4397242407303896, 1.4300354015278554, 1.442332774361841, 1.4054406558598846, 1.3646357369107514, 1.3243897894540713, 1.3228991988075274, 1.413638904415875, 1.3601639649711199, 1.2895472330911124, 1.2653251350847774, 1.3637041177566611, 1.3325880380100616, 1.3827091485000933, 1.4078628656605179, 1.4106577231227879, 1.3564374883547605, 1.3491708589528602, 1.2737097074715855, 1.3223402273150735, 1.3787963480529162, 1.3562511645239426, 1.2392397987702628, 1.2198621203651949, 1.4153158188932362, 1.3890441587479039, 1.3385504005962363, 1.3802869386994594, 1.3363145146264206, 1.3001676914477363, 1.2869386994596608, 1.3329606856716976, 1.2789267747344886, 1.3361281907956029, 1.4147568474007828, 1.3309111235327, 1.369852804173654, 1.3104155021427242, 1.2478106949878889, 1.2282466927520033, 1.2491149618036148, 1.2835848705049375, 1.3106018259735424, 1.3189863983603507, 1.2155766722563819, 1.2593627724986023, 1.2144587292714739, 1.1334078628656605, 1.0292528414384201, 1.0564561207378422, 1.1231600521706724, 1.1026644307806968, 1.1736538103223402, 1.1973169368362215, 1.2138997577790198, 1.2589901248369668, 1.3016582820942797, 1.2623439537916903, 1.27333705980995, 1.2988634246320105, 1.340786286566052, 1.3148872740823552, 1.2832122228433016, 1.2107322526551145, 1.2016023849450346, 1.2893609092602942, 1.3104155021427244, 1.3215949319918017, 1.2086826905161172, 1.2196757965343772, 1.2496739332960687, 1.3139556549282656, 1.2302962548910008, 1.2150177007639276, 1.2148313769331096, 1.2422209800633506, 1.195267374697224, 1.1317309483882991, 1.2021613564374887, 1.2256381591205516, 1.0557108254145704, 1.0089435438792624, 1.0186323830817963, 1.0525433202906653, 0.94074902179988829, 0.88149804359977657, 0.77678405068008216, 0.91969442891745856, 1.0275759269610583, 0.9761505496553009, 0.86491522265697784, 0.82802310415502145, 0.84516489659027372, 0.90255263648220618, 0.85858021240916726, 0.69722377492081233, 0.71846469163406013, 0.79672070057760391, 0.9051611701136576, 0.96068567169741037, 0.75461151481274447, 0.71995528228060379, 0.87851686230668902, 0.88410657723122799, 0.74194149431712308, 0.8282094279858393, 0.77138065958636115, 0.7158561580026086, 0.81237190236631274, 1.0033538289547235, 1.0810508664058132, 1.0696851127259179, 0.95230109931060214, 0.80491894913359441, 0.6852990497484629, 0.54238867151108627, 0.54201602384945036, 0.73504751257685874, 0.8615613937022546, 1.0402459474566796, 1.0531022917831192, 0.9726103968697597, 0.96757965343767482, 1.0583193590460218, 1.0299981367616919, 1.0080119247251724, 0.95584125209614312, 1.0022358859698157, 1.1557667225638157, 1.1660145332588041, 0.95509595677287118, 0.81982485559903118, 0.88783305384758715, 0.83864356251164507, 0.84125209614309671, 0.7585243152599217, 0.7091485000931621, 0.91130985653065022, 1.0180734115893422, 0.90590646543692954, 0.90311160797465984, 0.99981367616918204, 0.92547046767281538, 0.96907024408421827, 0.92397987702627171, 0.92099869573318438, 0.98565306502701711, 0.93534563070616727, 1.0281348984535126, 0.98285820756474762, 1.0068939817402647, 1.0790013042668158, 1.0039128004471773, 1.0037264766163594, 1.1013601639649717, 1.0855226383454444, 1.1063909073970564, 1.1019191354574249, 1.0793739519284515, 1.165641885597168, 1.1568846655487239, 1.1717905720141608, 1.1675051239053478, 1.1103037078442335, 1.2306689025526369, 1.122601080678219, 1.0892491149618038, 1.1619154089808086, 1.1492453884851876, 1.1207378423700392, 1.1730948388298867, 1.1818520588783308, 1.1429103782373766, 1.2135271101173841, 1.2355133221539034, 1.184274268678964, 1.1999254704676729, 1.1600521706726294, 1.1009875163033351, 1.1093720886901433, 1.1250232904788524, 1.1900503074343207, 1.2178125582261972, 1.1747717533072481, 1.2276877212595492, 1.1712316005217069, 1.2166946152412892, 1.1626607043040804, 1.2163219675796535, 1.1229737283398551, 1.1391839016210172, 1.2001117942984909, 1.146823178684554, 1.1533445127631825, 1.2001117942984911, 1.2053288615613937, 1.1593068753493574, 1.1548351034097262, 1.2166946152412894, 1.1721632196757965, 1.1803614682317867, 1.1199925470467671, 1.1157070989379543, 1.091857648593255, 1.1574436370411776, 1.0585056828768398, 1.109185764859326, 1.1013601639649713, 1.1980622321594931, 1.1490590646543692, 1.1934041363890444, 1.1622880566424445, 1.150177007639277, 0.68269051611701148, 0.41550214272405439, 0.70244084218371527, 1.0490031675051239, 1.1209241662008571, 1.1078814980435998, 1.0885038196385319, 1.072852617849823, 1.0249673933296071, 1.0072666294019006, 1.0981926588410658, 1.1149618036146824, 0.98397615054965548, 0.96813862493012881, 1.0052170672629031, 1.0678218744177381, 1.0845910191913546, 1.1075088503819637, 1.063909073970561, 1.1468231786845537, 1.1371343394820199, 1.0898080864542576, 1.0596236258617477, 0.99813676169182042, 1.1082541457052355, 1.0605552450158375, 1.0646543692938328, 1.0283212222843301, 1.0296254891000558, 1.0428544810881313, 1.082914104713993, 1.1049003167505125, 1.0804918949133591, 1.0793739519284518, 1.1341531581889321, 1.0976336873486119, 1.1022917831190613, 1.0998695733184274, 1.0998695733184272, 1.029811812930874, 1.0368921185019564, 1.073784237003913, 1.0329793180547793, 0.96124464318986413, 1.0497484628283957, 1.0953978013787971, 1.0790013042668158, 1.0668902552636481, 1.1121669461524128, 1.0963294205328862, 1.0337246133780511, 1.0016769144773618, 1.0478852245202164, 1.1034097261039688, 1.0292528414384201, 1.0430408049189492, 1.0596236258617477, 1.1058319359046023, 1.0370784423327744, 1.0506800819824857, 1.0322340227315077, 1.0499347866592137, 1.059250978200112, 1.0402459474566796, 1.0409912427799519, 1.0348425563629589, 1.0206819452207938, 1.0404322712874976, 1.0167691447736165, 1.0208682690516115, 1.000186323830818, 0.98528041736538097, 1.0214272405440656, 0.97354201602384949, 1.0005589714924539, 1.0400596236258619, 0.98882057015092217, 1.0191913545742501, 0.98043599776411428, 0.95192845164896567, 1.0095025153717161, 1.0469536053661261, 1.0163964971119805, 0.97372833985466745, 1.0169554686044346, 1.0264579839761503, 1.0255263648220607, 0.96683435811440288, 1.0365194708403205, 1.0104341345258061, 1.0203092975591579, 0.94093534563070602, 0.94093534563070613, 0.93776784050680095, 0.98323085522638332, 0.9172722191168251, 0.91429103782373777, 0.9016210173281165, 0.9087013228991988, 0.94987888950996857, 0.85913918390162125, 0.91373206633128401, 0.94857462269424242, 0.94391652692379369, 0.92882429662753874, 0.92677473448854109, 0.88801937767840522, 0.88149804359977657, 0.88485187255449971, 0.88038010061486882, 0.87982112912241472, 0.86305198434879837, 0.86808272778088325, 0.86901434693497293, 0.88038010061486849, 0.9077697037451089, 0.88205701509223022, 0.85112725917644871, 0.75740637227501395, 0.76243711570709916, 0.85019564002235881, 0.8220607415688469, 0.82075647475312119, 0.80119247251723502, 0.84479224892863791, 0.94317123160052163, 0.85597167877771585, 0.84963666852990483, 0.90013042668157273, 0.93273709707471586, 0.87069126141233455, 0.87907583379914311, 0.92584311533445118, 0.89155953046394654, 0.83528973355692215, 0.82411030370784433, 0.79709334823923972, 0.77585243152599226, 0.79150363331470097, 0.71212968138624944, 0.73206633128377141, 0.74156884665548739, 0.75200298118129305, 0.80193776784050685, 0.78572759455934416, 0.88112539593814043, 0.84963666852990483, 0.65940003726476615, 0.81814794112166933, 0.88373392956959185, 0.85820756474753157, 0.83193590460219846, 0.82131544624557495, 0.88187069126141249, 0.88019377678405075, 0.84591019191354577, 0.81647102664430804, 0.85131358300726667, 0.84181106763555058, 0.84609651574436384, 0.85168623066890259, 0.82038382709148505, 0.79355319545369873, 0.80529159679523021, 0.78311906092789263, 0.85373579280790024, 0.8192658841065773, 0.83491708589528579, 0.77492081237190236, 0.82243338923048259, 0.79914291037823748, 0.84143841997391466, 0.8345444382336501, 0.80026085336314523, 0.7905720141606114, 0.77939258431153347, 0.80286938699459676, 0.86435625116452408, 0.81330352152040264, 0.80324203465623256, 0.81348984535122038, 0.83100428544810911, 0.81106763555058714, 0.76355505869200668, 0.74659959008757204, 0.80659586361095581, 0.82634618967765983, 0.81665735047512567, 0.78088317495807724, 0.78088317495807702, 0.75982858207564752, 0.77585243152599226, 0.76020122973728355, 0.77678405068008205, 0.78405068008198253, 0.74287311347121299, 0.7594559344140116, 0.73989193217812554, 0.72945779765231966, 0.72442705422023468, 0.65269237935531954, 0.73076206446804548, 0.77715669834171786, 0.75274827650456466, 0.72293646357369112, 0.68101360163964986, 0.72424073038941694, 0.76560462083100422, 0.79001304266815742, 0.78889509968324956, 0.73635177939258445, 0.72070057760387551, 0.69461524128936081, 0.68287683994782933, 0.65530091298677096, 0.69778274641326643, 0.75666107695174212, 0.65530091298677107, 0.60108067821874422, 0.60834730762064471, 0.61934041363890435, 0.60722936463573696, 0.58393888578349185, 0.62138997577790189, 0.67654182970001864, 0.64971119806223221, 0.75293460033538306, 0.66349916154276156, 0.67113843860629763, 0.69871436556735611, 0.66852990497484643, 0.65735047512576872, 0.60182597354201606, 0.64039500652133408, 0.65269237935531943, 0.74995341904229562, 0.65641885597167893, 0.61542761319172712, 0.49282653251350855, 0.5449972051425378, 0.61580026085336315, 0.57443637041177564, 0.55226383454443839, 0.55785354946897692, 0.39239798770262729, 0.37469722377492087, 0.42407303894168058, 0.45667970933482382, 0.36724427054220232, 0.36258617477175331, 0.34246320104341349, 0.34339482019750334, 0.32140860816098393, 0.31022917831190611, 0.28358487050493764, 0.22787404509036702, 0.24352524687907584, 0.24333892304825791, 0.27352338364076773, 0.24762437115707098, 0.23197316936836226, 0.24408421837152974, 0.24017141792435251, 0.24408421837152972, 0.25489100055897151, 0.2245202161356438, 0.22265697782746413, 0.24054406558598854, 0.22452021613564382, 0.24371157070989377, 0.24017141792435259, 0.22135271101173842, 0.22414756847400782, 0.24892863797279677, 0.23588596981553941, 0.24632010434134535, 0.22675610210545932, 0.22619713061300539, 0.23979877026271662, 0.23923979877026272, 0.2383081796161729, 0.23327743618408794, 0.2248928637972796, 0.23010993106018263, 0.24259362772498605, 0.28880193776784063, 0.26476616359232347, 0.252468790758338, 0.29588224333892293, 0.27482765045649343, 0.27464132662567553, 0.30743432084963668, 0.34618967765977265, 0.2437115707098938, 0.26662940190050305, 0.25731321035960497, 0.22899198807527479, 0.22135271101173842, 0.23160052170672629, 0.21874417738028692, 0.21818520588783302, 0.23961244643189866, 0.24203465623253217, 0.22582448295136948, 0.23644494130799334, 0.23476802683063161, 0.26103968697596425, 0.28433016582820936, 0.22284330165828212, 0.2761319172722192, 0.32755729457797644, 0.28414384199739151, 0.31022917831190611, 0.33128377119433572, 0.28209427985839397, 0.24035774175517052, 0.27538662194894725, 0.29383268119992556, 0.28246692752002989, 0.24613378051052726, 0.22284330165828214, 0.22712874976709524, 0.24017141792435254, 0.31581889323644491, 0.33687348611887458, 0.33463760014905908, 0.26402086826905163, 0.23048257872181857, 0.21948947270355879, 0.21911682504192281, 0.29811812930873866, 0.37544251909819265, 0.30463946338736725, 0.28116266070430418, 0.23215949319918019, 0.24147568474007827, 0.31022917831190611, 0.33277436184087944, 0.24296627538662197, 0.26905161170113662, 0.32010434134525806, 0.29532327184646923, 0.21110490031675053, 0.25060555245015842, 0.27799515558039872, 0.27575926961058317, 0.33538289547233091, 0.38326811999254706, 0.40730389416806406, 0.29662753866219488, 0.24222098006335008, 0.24613378051052734, 0.33724613378051055, 0.44419601267002046, 0.37339295695919517, 0.35010247810694983, 0.35681013601639644, 0.29103782373765608, 0.24818334264952491, 0.31973169368362214, 0.35997764114030184, 0.40208682690516112, 0.44102850754611528, 0.40823551332215396, 0.31488727408235517, 0.32345817029998136, 0.45071734674864911, 0.41270728526178491, 0.35010247810694989, 0.43432084963666856, 0.39836035028880196, 0.33817775293460034, 0.32643935159306875, 0.37562884292901061, 0.41922861934041367, 0.47363517793925847, 0.46133780510527289, 0.30985653065027013, 0.27594559344140118, 0.30836594000372647, 0.42761319172722184, 0.37805105272964407, 0.3599776411403019, 0.42947643003540154, 0.42463201043413451, 0.40618595118315637, 0.36333147009502514, 0.27911309856530647, 0.403391093720887, 0.4332029066517607, 0.38494503446990874, 0.43264393515930699, 0.41345258058505691, 0.39295695919508106, 0.42090553381777529, 0.39668343581144022, 0.46077883361281907, 0.45127631824110309, 0.45966089062791132, 0.37674678591391841, 0.31395565492826538, 0.42481833426495252, 0.42239612446431907, 0.52897335569219317, 0.50549655300912999, 0.51816657350475126, 0.45108999441028513, 0.30724799701881872, 0.28768399478293272, 0.43953791689957139, 0.4591019191354575, 0.44959940376374136, 0.49972051425377306, 0.55300912986771023, 0.53120924166200867, 0.46748649152226568, 0.50940935345630711, 0.51742127818147943, 0.51369480156512026, 0.5287870318613751, 0.5558039873299796, 0.58822433389230488, 0.53605366126327569, 0.45295323271846477, 0.47792062604807156, 0.49655300912986777, 0.58487050493758164, 0.47046767281535312, 0.47102664430780689, 0.55114589155953042, 0.5453698528041736, 0.46487795789081432, 0.44810881311719775, 0.38159120551518544, 0.41512949506241859, 0.48164710266443084, 2.6580957704490404, 0.71212968138624932, 0.4102850754611515, 0.38028693869945968, 0.32681199925470467, 0.43320290665176081, 0.40115520775107139, 0.44997205142537733, 0.46021986212036525, 0.52915967952301091, 0.63797279672070062, 0.55673560648406939, 0.48034283584870507, 0.45258058505682874, 0.45108999441028519, 0.43469349729830453, 0.50270169554686051, 0.4918949133594186, 0.47847959754052549, 0.43450717346748641, 0.46990870132289925, 0.44028321222284339, 0.49487609465250604, 0.54816471026644309, 0.58654741941494337, 0.51648965902738975, 0.48798211291224153, 0.53903484255636314, 0.53642630892491172, 0.46394633873672453, 0.48146077883361282, 0.49114961803614687, 0.54704676728153523, 0.5660517980249673, 0.55971678777715683, 0.57443637041177564, 0.56102105459288243, 0.51239053474939444, 0.57331842742686812, 0.5701509223029626, 0.56772871250232904, 0.57033724613378045, 0.53884851872554507, 0.51574436370411769, 0.5265511458915596, 0.55114589155953053, 0.58785168623066908, 0.59977641140301852, 0.50773243897894549, 0.53866219489472711, 0.57275945593441413, 0.57983976150549654, 0.59027389603130254, 0.57723122787404513, 0.55617663499161551, 0.55058692006707655, 0.53474939444754988, 0.5233836407676542, 0.56530650270169569, 0.62884292901062044, 0.64561207378423691, 0.64058133035215203, 0.62083100428544824, 0.63909073970560837, 0.56586547419414945, 0.60033538289547228, 0.65008384572386824, 0.64169927333705978, 0.64989752189305028, 0.64673001676914477, 0.6722563815912056, 0.66312651388112553, 0.65213340786286567, 0.65902738960313023, 0.70430408049189497, 0.70430408049189497]) * 2.0

# wc, sc = [], []
# for i in range(len(wav)):
#     w = wav[i]
#     if min(wav_ex) <= w <= max(wav_ex):
#         wc.append(w)
#         sc.append(spec_a0[i])
# wav, spec_a0 = np.asarray(wc), np.asarray(sc)

# spec_a0_bin = rebin_spec(wav, spec_a0, wav_ex)

plt.plot(wav, spec_a0, label='Phoenix')
# plt.plot(wav_ex, spec_a0_bin, label='Phoenix binned')
# plt.show()

# wav = np.linspace(0.3, 2.5, len(spec_a0))   # wavelength grid of models

# dx = 2.2 / len(wav)
# sigma = 50.0
# gx = np.arange(-3*sigma, 3*sigma, dx)
# gaussian = np.exp(-(wav/sigma)**2.0/2.0)
# # result = np.convolve(spec, gaussian, mode="full")
# result = convolve(spec, gaussian)
# # plt.plot(result)
# # plt.show()

a0v_m_w, a0v_m_s = load_model_spec('data/uka0v.dat', [-1e4, 1e4])
# m1v_m_w, m1v_m_s = load_model_spec('data/ukm1v.dat', [0, -1])

stsci_f = np.genfromtxt('A0V_9500_g40.dat')
# stsci_a0_w, stsci_a0_s = stsci_f[:,0], stsci_f[:,1]
stsci_a0_w, stsci_a0_s = [], []
for i in range(len(stsci_f[:,0])):
    w = stsci_f[:,0][i] / 1e4
    if 0.0 <= w <= 5.0:
        stsci_a0_w.append(w)
        stsci_a0_s.append(stsci_f[:,1][i])
stsci_a0_w = np.asarray(stsci_a0_w)
stsci_a0_s = np.asarray(stsci_a0_s) / np.nanmax(stsci_a0_s)

# spec_a0_new = rebin_spec(wav, spec_a0, wav_ex)      # phoenix model
# sn_a0_esa = rebin_spec(a0v_m_w, a0v_m_s, wav_ex)    # ESA model
# sn_a0_stsci = rebin_spec(stsci_a0_w, stsci_a0_s, wav_ex)

a0v_m_s /= np.nanmax(a0v_m_s)
plt.plot(a0v_m_w, a0v_m_s, label='ESA')
# plt.plot(wav_ex, sn_a0_esa, label='ESA binned')

# plt.plot(m1v_m_w, m1v_m_s, label='ESA')

plt.plot(stsci_a0_w, stsci_a0_s, label='STScI')
# plt.plot(wav_ex, sn_a0_stsci, label='STScI binned')

# plt.plot(wav_ex, spec_a0_ex, color='k')

for thing in [wav, a0v_m_w, stsci_a0_w]:
    print min(thing), max(thing), len(thing)

# earth_file = np.genfromtxt('data/mktrans_zm_10_10.dat')
# earth_wav_full, earth_spec_full = earth_file[:,0], earth_file[:,1]
# plt.plot(earth_wav_full, earth_spec_full, label='Earth', alpha=0.4)

# plt.plot(wav, result)
# plt.xlim(0.9, 1.5)
plt.legend()
plt.show()


# hs = []
#
# for filename in glob.glob('PHOENIX-ACES-AGSS-COND-2011_R10000FITS_Z-0.0/lte03600*'):
#     f = fits.open(filename)
#     spec = f[0].data
#     hs.append(f[0].header)
#
#     # plt.plot(spec)
# # plt.show()
#
# for thing in hs[0]:
#     s = str(thing) + '\t'
#     for h in hs:
#         s += (str(h[thing]) + '\t')
#
#     print s
